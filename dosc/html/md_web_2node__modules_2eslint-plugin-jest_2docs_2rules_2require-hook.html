<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AREA: Require setup and teardown code to be within a hook (&lt;tt&gt;require-hook&lt;/tt&gt;)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AREA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Require setup and teardown code to be within a hook (&lt;tt&gt;require-hook&lt;/tt&gt;)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md10871"></a> Often while writing tests you have some setup work that needs to happen before tests run, and you have some finishing work that needs to happen after tests run. Jest provides helper functions to handle this.</p>
<p>It's common when writing tests to need to perform setup work that needs to happen before tests run, and finishing work after tests run.</p>
<p>Because Jest executes all <code>describe</code> handlers in a test file <em>before</em> it executes any of the actual tests, it's important to ensure setup and teardown work is done inside <code>before*</code> and <code>after*</code> handlers respectively, rather than inside the <code>describe</code> blocks.</p>
<h1><a class="anchor" id="autotoc_md10872"></a>
Rule details</h1>
<p>This rule flags any expression that is either at the toplevel of a test file or directly within the body of a <code>describe</code>, <em>except</em> for the following:</p>
<ul>
<li><code>import</code> statements</li>
<li><code>const</code> variables</li>
<li><code>let</code> <em>declarations</em>, and initializations to <code>null</code> or <code>undefined</code></li>
<li>Classes</li>
<li>Types</li>
<li>Calls to the standard Jest globals</li>
</ul>
<p>This rule flags any function calls within test files that are directly within the body of a <code>describe</code>, and suggests wrapping them in one of the four lifecycle hooks.</p>
<p>Here is a slightly contrived test file showcasing some common cases that would be flagged:</p>
<div class="fragment"><div class="line">import { database, isCity } from &#39;../database&#39;;</div>
<div class="line">import { Logger } from &#39;../../../src/Logger&#39;;</div>
<div class="line">import { loadCities } from &#39;../api&#39;;</div>
<div class="line"> </div>
<div class="line">jest.mock(&#39;../api&#39;);</div>
<div class="line"> </div>
<div class="line">const initializeCityDatabase = () =&gt; {</div>
<div class="line">  database.addCity(&#39;Vienna&#39;);</div>
<div class="line">  database.addCity(&#39;San Juan&#39;);</div>
<div class="line">  database.addCity(&#39;Wellington&#39;);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">const clearCityDatabase = () =&gt; {</div>
<div class="line">  database.clear();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">initializeCityDatabase();</div>
<div class="line"> </div>
<div class="line">test(&#39;that persists cities&#39;, () =&gt; {</div>
<div class="line">  expect(database.cities.length).toHaveLength(3);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">test(&#39;city database has Vienna&#39;, () =&gt; {</div>
<div class="line">  expect(isCity(&#39;Vienna&#39;)).toBeTruthy();</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">test(&#39;city database has San Juan&#39;, () =&gt; {</div>
<div class="line">  expect(isCity(&#39;San Juan&#39;)).toBeTruthy();</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">describe(&#39;when loading cities from the api&#39;, () =&gt; {</div>
<div class="line">  let consoleWarnSpy = jest.spyOn(console, &#39;warn&#39;);</div>
<div class="line"> </div>
<div class="line">  loadCities.mockResolvedValue([&#39;Wellington&#39;, &#39;London&#39;]);</div>
<div class="line"> </div>
<div class="line">  it(&#39;does not duplicate cities&#39;, async () =&gt; {</div>
<div class="line">    await database.loadCities();</div>
<div class="line"> </div>
<div class="line">    expect(database.cities).toHaveLength(4);</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  it(&#39;logs any duplicates&#39;, async () =&gt; {</div>
<div class="line">    await database.loadCities();</div>
<div class="line"> </div>
<div class="line">    expect(consoleWarnSpy).toHaveBeenCalledWith(</div>
<div class="line">      &#39;Ignored duplicate cities: Wellington&#39;,</div>
<div class="line">    );</div>
<div class="line">  });</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">clearCityDatabase();</div>
</div><!-- fragment --><p>Here is the same slightly contrived test file showcasing the same common cases but in ways that would be <b>not</b> flagged:</p>
<div class="fragment"><div class="line">import { database, isCity } from &#39;../database&#39;;</div>
<div class="line">import { Logger } from &#39;../../../src/Logger&#39;;</div>
<div class="line">import { loadCities } from &#39;../api&#39;;</div>
<div class="line"> </div>
<div class="line">jest.mock(&#39;../api&#39;);</div>
<div class="line"> </div>
<div class="line">const initializeCityDatabase = () =&gt; {</div>
<div class="line">  database.addCity(&#39;Vienna&#39;);</div>
<div class="line">  database.addCity(&#39;San Juan&#39;);</div>
<div class="line">  database.addCity(&#39;Wellington&#39;);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">const clearCityDatabase = () =&gt; {</div>
<div class="line">  database.clear();</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">beforeEach(() =&gt; {</div>
<div class="line">  initializeCityDatabase();</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">test(&#39;that persists cities&#39;, () =&gt; {</div>
<div class="line">  expect(database.cities.length).toHaveLength(3);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">test(&#39;city database has Vienna&#39;, () =&gt; {</div>
<div class="line">  expect(isCity(&#39;Vienna&#39;)).toBeTruthy();</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">test(&#39;city database has San Juan&#39;, () =&gt; {</div>
<div class="line">  expect(isCity(&#39;San Juan&#39;)).toBeTruthy();</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">describe(&#39;when loading cities from the api&#39;, () =&gt; {</div>
<div class="line">  let consoleWarnSpy;</div>
<div class="line"> </div>
<div class="line">  beforeEach(() =&gt; {</div>
<div class="line">    consoleWarnSpy = jest.spyOn(console, &#39;warn&#39;);</div>
<div class="line">    loadCities.mockResolvedValue([&#39;Wellington&#39;, &#39;London&#39;]);</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  it(&#39;does not duplicate cities&#39;, async () =&gt; {</div>
<div class="line">    await database.loadCities();</div>
<div class="line"> </div>
<div class="line">    expect(database.cities).toHaveLength(4);</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  it(&#39;logs any duplicates&#39;, async () =&gt; {</div>
<div class="line">    await database.loadCities();</div>
<div class="line"> </div>
<div class="line">    expect(consoleWarnSpy).toHaveBeenCalledWith(</div>
<div class="line">      &#39;Ignored duplicate cities: Wellington&#39;,</div>
<div class="line">    );</div>
<div class="line">  });</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">afterEach(() =&gt; {</div>
<div class="line">  clearCityDatabase();</div>
<div class="line">});</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10873"></a>
Options</h1>
<p>If there are methods that you want to call outside of hooks and tests, you can mark them as allowed using the <code>allowedFunctionCalls</code> option.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;jest/require-hook&quot;: [</div>
<div class="line">    &quot;error&quot;,</div>
<div class="line">    {</div>
<div class="line">      &quot;allowedFunctionCalls&quot;: [&quot;enableAutoDestroy&quot;]</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>Examples of <b>correct</b> code when using <code>{ "allowedFunctionCalls": ["enableAutoDestroy"] }</code> option:</p>
<div class="fragment"><div class="line">/* eslint jest/require-hook: [&quot;error&quot;, { &quot;allowedFunctionCalls&quot;: [&quot;enableAutoDestroy&quot;] }] */</div>
<div class="line"> </div>
<div class="line">import { enableAutoDestroy, mount } from &#39;@vue/test-utils&#39;;</div>
<div class="line">import { initDatabase, tearDownDatabase } from &#39;./databaseUtils&#39;;</div>
<div class="line"> </div>
<div class="line">enableAutoDestroy(afterEach);</div>
<div class="line"> </div>
<div class="line">beforeEach(initDatabase);</div>
<div class="line">afterEach(tearDownDatabase);</div>
<div class="line"> </div>
<div class="line">describe(&#39;Foo&#39;, () =&gt; {</div>
<div class="line">  test(&#39;always returns 42&#39;, () =&gt; {</div>
<div class="line">    expect(global.getAnswer()).toBe(42);</div>
<div class="line">  });</div>
<div class="line">});</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
