<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AREA: watchpack</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AREA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">watchpack</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md26601"></a> Wrapper library for directory and file watching.</p>
<p><a href="https://github.com/webpack/watchpack/actions/workflows/test.yml"><img src="https://github.com/webpack/watchpack/actions/workflows/test.yml/badge.svg" alt="Test" style="pointer-events: none;" class="inline"/></a> <a href="https://codecov.io/gh/webpack/watchpack"><img src="https://codecov.io/gh/webpack/watchpack/graph/badge.svg?token=8xk2OrrxWm" alt="Codecov" style="pointer-events: none;" class="inline"/></a> <a href="https://www.npmjs.com/package/watchpack"><img src="https://img.shields.io/npm/dm/watchpack.svg" alt="Downloads" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md26602"></a>
Concept</h1>
<p>watchpack high level API doesn't map directly to watchers. Instead a three level architecture ensures that for each directory only a single watcher exists.</p>
<ul>
<li>The high level API requests <code>DirectoryWatchers</code> from a <code>WatcherManager</code>, which ensures that only a single <code>DirectoryWatcher</code> per directory is created.</li>
<li>A user-faced <code>Watcher</code> can be obtained from a <code>DirectoryWatcher</code> and provides a filtered view on the <code>DirectoryWatcher</code>.</li>
<li>Reference-counting is used on the <code>DirectoryWatcher</code> and <code>Watcher</code> to decide when to close them.</li>
<li>The real watchers are created by the <code>DirectoryWatcher</code>.</li>
<li>Files are never watched directly. This should keep the watcher count low.</li>
<li>Watching can be started in the past. This way watching can start after file reading.</li>
<li>Symlinks are not followed, instead the symlink is watched.</li>
</ul>
<h1><a class="anchor" id="autotoc_md26603"></a>
API</h1>
<div class="fragment"><div class="line">var Watchpack = require(&quot;watchpack&quot;);</div>
<div class="line"> </div>
<div class="line">var wp = new Watchpack({</div>
<div class="line">    // options:</div>
<div class="line">    aggregateTimeout: 1000,</div>
<div class="line">    // fire &quot;aggregated&quot; event when after a change for 1000ms no additional change occurred</div>
<div class="line">    // aggregated defaults to undefined, which doesn&#39;t fire an &quot;aggregated&quot; event</div>
<div class="line"> </div>
<div class="line">    poll: true,</div>
<div class="line">    // poll: true - use polling with the default interval</div>
<div class="line">    // poll: 10000 - use polling with an interval of 10s</div>
<div class="line">    // poll defaults to undefined, which prefer native watching methods</div>
<div class="line">    // Note: enable polling when watching on a network path</div>
<div class="line">    // When WATCHPACK_POLLING environment variable is set it will override this option</div>
<div class="line"> </div>
<div class="line">    followSymlinks: true,</div>
<div class="line">    // true: follows symlinks and watches symlinks and real files</div>
<div class="line">    //   (This makes sense when symlinks has not been resolved yet, comes with a performance hit)</div>
<div class="line">    // false (default): watches only specified item they may be real files or symlinks</div>
<div class="line">    //   (This makes sense when symlinks has already been resolved)</div>
<div class="line"> </div>
<div class="line">    ignored: &quot;**/.git&quot;</div>
<div class="line">    // ignored: &quot;string&quot; - a glob pattern for files or folders that should not be watched</div>
<div class="line">    // ignored: [&quot;string&quot;, &quot;string&quot;] - multiple glob patterns that should be ignored</div>
<div class="line">    // ignored: /regexp/ - a regular expression for files or folders that should not be watched</div>
<div class="line">    // ignored: (entry) =&gt; boolean - an arbitrary function which must return truthy to ignore an entry</div>
<div class="line">    // For all cases expect the arbitrary function the path will have path separator normalized to &#39;/&#39;.</div>
<div class="line">    // All subdirectories are ignored too</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">// Watchpack.prototype.watch({</div>
<div class="line">//   files: Iterable&lt;string&gt;,</div>
<div class="line">//   directories: Iterable&lt;string&gt;,</div>
<div class="line">//   missing: Iterable&lt;string&gt;,</div>
<div class="line">//   startTime?: number</div>
<div class="line">// })</div>
<div class="line">wp.watch({</div>
<div class="line">    files: listOfFiles,</div>
<div class="line">    directories: listOfDirectories,</div>
<div class="line">    missing: listOfNotExistingItems,</div>
<div class="line">    startTime: Date.now() - 10000</div>
<div class="line">});</div>
<div class="line">// starts watching these files and directories</div>
<div class="line">// calling this again will override the files and directories</div>
<div class="line">// files: can be files or directories, for files: content and existence changes are tracked</div>
<div class="line">//        for directories: only existence and timestamp changes are tracked</div>
<div class="line">// directories: only directories, directory content (and content of children, ...) and</div>
<div class="line">//              existence changes are tracked.</div>
<div class="line">//              assumed to exist, when directory is not found without further information a remove event is emitted</div>
<div class="line">// missing: can be files or directorees,</div>
<div class="line">//          only existence changes are tracked</div>
<div class="line">//          expected to not exist, no remove event is emitted when not found initially</div>
<div class="line">// files and directories are assumed to exist, when they are not found without further information a remove event is emitted</div>
<div class="line">// missing is assumed to not exist and no remove event is emitted</div>
<div class="line"> </div>
<div class="line">wp.on(&quot;change&quot;, function(filePath, mtime, explanation) {</div>
<div class="line">    // filePath: the changed file</div>
<div class="line">    // mtime: last modified time for the changed file</div>
<div class="line">    // explanation: textual information how this change was detected</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">wp.on(&quot;remove&quot;, function(filePath, explanation) {</div>
<div class="line">    // filePath: the removed file or directory</div>
<div class="line">    // explanation: textual information how this change was detected</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">wp.on(&quot;aggregated&quot;, function(changes, removals) {</div>
<div class="line">    // changes: a Set of all changed files</div>
<div class="line">    // removals: a Set of all removed files</div>
<div class="line">    // watchpack gives up ownership on these Sets.</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">// Watchpack.prototype.pause()</div>
<div class="line">wp.pause();</div>
<div class="line">// stops emitting events, but keeps watchers open</div>
<div class="line">// next &quot;watch&quot; call can reuse the watchers</div>
<div class="line">// The watcher will keep aggregating events</div>
<div class="line">// which can be received with getAggregated()</div>
<div class="line"> </div>
<div class="line">// Watchpack.prototype.close()</div>
<div class="line">wp.close();</div>
<div class="line">// stops emitting events and closes all watchers</div>
<div class="line"> </div>
<div class="line">// Watchpack.prototype.getAggregated(): { changes: Set&lt;string&gt;, removals: Set&lt;string&gt; }</div>
<div class="line">const { changes, removals } = wp.getAggregated();</div>
<div class="line">// returns the current aggregated info and removes that from the watcher</div>
<div class="line">// The next aggregated event won&#39;t include that info and will only emitted</div>
<div class="line">// when futher changes happen</div>
<div class="line">// Can also be used when paused.</div>
<div class="line"> </div>
<div class="line">// Watchpack.prototype.collectTimeInfoEntries(fileInfoEntries: Map&lt;string, Entry&gt;, directoryInfoEntries: Map&lt;string, Entry&gt;)</div>
<div class="line">wp.collectTimeInfoEntries(fileInfoEntries, directoryInfoEntries);</div>
<div class="line">// collects time info objects for all known files and directories</div>
<div class="line">// this include info from files not directly watched</div>
<div class="line">// key: absolute path, value: object with { safeTime, timestamp }</div>
<div class="line">// safeTime: a point in time at which it is safe to say all changes happened before that</div>
<div class="line">// timestamp: only for files, the mtime timestamp of the file</div>
<div class="line"> </div>
<div class="line">// Watchpack.prototype.getTimeInfoEntries()</div>
<div class="line">var fileTimes = wp.getTimeInfoEntries();</div>
<div class="line">// returns a Map with all known time info objects for files and directories</div>
<div class="line">// similar to collectTimeInfoEntries but returns a single map with all entries</div>
<div class="line"> </div>
<div class="line">// (deprecated)</div>
<div class="line">// Watchpack.prototype.getTimes()</div>
<div class="line">var fileTimes = wp.getTimes();</div>
<div class="line">// returns an object with all known change times for files</div>
<div class="line">// this include timestamps from files not directly watched</div>
<div class="line">// key: absolute path, value: timestamp as number</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
