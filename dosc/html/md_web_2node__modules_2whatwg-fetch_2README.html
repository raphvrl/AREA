<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AREA: window.fetch polyfill</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AREA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">window.fetch polyfill</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md27147"></a> <a href="https://securityscorecards.dev/viewer/?uri=github.com/JakeChampion/fetch"><img src="https://api.securityscorecards.dev/projects/github.com/JakeChampion/fetch/badge" alt="OpenSSF Scorecard" class="inline"/></a></p>
<p>The <code>fetch()</code> function is a Promise-based mechanism for programmatically making web requests in the browser. This project is a polyfill that implements a subset of the standard <a href="https://fetch.spec.whatwg.org">Fetch specification</a>, enough to make <code>fetch</code> a viable replacement for most uses of XMLHttpRequest in traditional web applications.</p>
<h1><a class="anchor" id="autotoc_md27148"></a>
Table of Contents</h1>
<ul>
<li>Read this first</li>
<li><a class="el" href="md_web_2node__modules_2web-vitals_2README.html#installation">Installation</a></li>
<li><a class="el" href="md_web_2node__modules_2eslint-plugin-jsx-a11y_2README.html#usage">Usage</a><ul>
<li>Importing</li>
<li>HTML</li>
<li>JSON</li>
<li>Response metadata</li>
<li>Post form</li>
<li>Post JSON</li>
<li>File upload</li>
<li>Caveats<ul>
<li>Handling HTTP error statuses</li>
<li>Sending cookies</li>
<li>Receiving cookies</li>
<li>Redirect modes</li>
<li>Obtaining the Response URL</li>
<li>Aborting requests</li>
</ul>
</li>
</ul>
</li>
<li>Browser Support</li>
</ul>
<h1><a class="anchor" id="autotoc_md27149"></a>
Read this first</h1>
<ul>
<li>If you believe you found a bug with how <code>fetch</code> behaves in your browser, please <b>don't open an issue in this repository</b> unless you are testing in an old version of a browser that doesn't support <code>window.fetch</code> natively. Make sure you read this <em>entire</em> readme, especially the Caveats section, as there's probably a known work-around for an issue you've found. This project is a <em>polyfill</em>, and since all modern browsers now implement the <code>fetch</code> function natively, <b>no code from this project</b> actually takes any effect there. See Browser support for detailed information.</li>
<li>If you have trouble <b>making a request to another domain</b> (a different subdomain or port number also constitutes another domain), please familiarize yourself with all the intricacies and limitations of <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS" title="Cross-origin resource sharing">CORS</a> requests. Because CORS requires participation of the server by implementing specific HTTP response headers, it is often nontrivial to set up or debug. CORS is exclusively handled by the browser's internal mechanisms which this polyfill cannot influence.</li>
<li>This project <b>doesn't work under Node.js environments</b>. It's meant for web browsers only. You should ensure that your application doesn't try to package and run this on the server.</li>
<li>If you have an idea for a new feature of <code>fetch</code>, <b>submit your feature requests</b> to the <a href="https://github.com/whatwg/fetch/issues">specification's repository</a>. We only add features and APIs that are part of the <a href="https://fetch.spec.whatwg.org">Fetch specification</a>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md27150"></a>
Installation</h1>
<div class="fragment"><div class="line">npm install whatwg-fetch --save</div>
</div><!-- fragment --><p>You will also need a Promise polyfill for <a href="https://caniuse.com/promises">older browsers</a>. We recommend <a href="https://github.com/taylorhakes/promise-polyfill">taylorhakes/promise-polyfill</a> for its small size and Promises/A+ compatibility.</p>
<h1><a class="anchor" id="autotoc_md27151"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md27152"></a>
Importing</h2>
<p>Importing will automatically polyfill <code>window.fetch</code> and related APIs:</p>
<div class="fragment"><div class="line">import &#39;whatwg-fetch&#39;</div>
<div class="line"> </div>
<div class="line">window.fetch(...)</div>
</div><!-- fragment --><p>If for some reason you need to access the polyfill implementation, it is available via exports:</p>
<div class="fragment"><div class="line">import {fetch as fetchPolyfill} from &#39;whatwg-fetch&#39;</div>
<div class="line"> </div>
<div class="line">window.fetch(...)   // use native browser version</div>
<div class="line">fetchPolyfill(...)  // use polyfill implementation</div>
</div><!-- fragment --><p>This approach can be used to, for example, use abort functionality in browsers that implement a native but outdated version of fetch that doesn't support aborting.</p>
<p>For use with webpack, add this package in the <code>entry</code> configuration option before your application entry point:</p>
<div class="fragment"><div class="line">entry: [&#39;whatwg-fetch&#39;, ...]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27153"></a>
HTML</h2>
<div class="fragment"><div class="line">fetch(&#39;/users.html&#39;)</div>
<div class="line">  .then(function(response) {</div>
<div class="line">    return response.text()</div>
<div class="line">  }).then(function(body) {</div>
<div class="line">    document.body.innerHTML = body</div>
<div class="line">  })</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27154"></a>
JSON</h2>
<div class="fragment"><div class="line">fetch(&#39;/users.json&#39;)</div>
<div class="line">  .then(function(response) {</div>
<div class="line">    return response.json()</div>
<div class="line">  }).then(function(json) {</div>
<div class="line">    console.log(&#39;parsed json&#39;, json)</div>
<div class="line">  }).catch(function(ex) {</div>
<div class="line">    console.log(&#39;parsing failed&#39;, ex)</div>
<div class="line">  })</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27155"></a>
Response metadata</h2>
<div class="fragment"><div class="line">fetch(&#39;/users.json&#39;).then(function(response) {</div>
<div class="line">  console.log(response.headers.get(&#39;Content-Type&#39;))</div>
<div class="line">  console.log(response.headers.get(&#39;Date&#39;))</div>
<div class="line">  console.log(response.status)</div>
<div class="line">  console.log(response.statusText)</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27156"></a>
Post form</h2>
<div class="fragment"><div class="line">var form = document.querySelector(&#39;form&#39;)</div>
<div class="line"> </div>
<div class="line">fetch(&#39;/users&#39;, {</div>
<div class="line">  method: &#39;POST&#39;,</div>
<div class="line">  body: new FormData(form)</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27157"></a>
Post JSON</h2>
<div class="fragment"><div class="line">fetch(&#39;/users&#39;, {</div>
<div class="line">  method: &#39;POST&#39;,</div>
<div class="line">  headers: {</div>
<div class="line">    &#39;Content-Type&#39;: &#39;application/json&#39;</div>
<div class="line">  },</div>
<div class="line">  body: JSON.stringify({</div>
<div class="line">    name: &#39;Hubot&#39;,</div>
<div class="line">    login: &#39;hubot&#39;,</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27158"></a>
File upload</h2>
<div class="fragment"><div class="line">var input = document.querySelector(&#39;input[type=&quot;file&quot;]&#39;)</div>
<div class="line"> </div>
<div class="line">var data = new FormData()</div>
<div class="line">data.append(&#39;file&#39;, input.files[0])</div>
<div class="line">data.append(&#39;user&#39;, &#39;hubot&#39;)</div>
<div class="line"> </div>
<div class="line">fetch(&#39;/avatars&#39;, {</div>
<div class="line">  method: &#39;POST&#39;,</div>
<div class="line">  body: data</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27159"></a>
Caveats</h2>
<ul>
<li>The Promise returned from <code>fetch()</code> <b>won't reject on HTTP error status</b> even if the response is an HTTP 404 or 500. Instead, it will resolve normally, and it will only reject on network failure or if anything prevented the request from completing.</li>
<li>For maximum browser compatibility when it comes to sending &amp; receiving cookies, always supply the &lsquo;credentials: 'same-origin&rsquo;` option instead of relying on the default. See Sending cookies.</li>
<li>Not all Fetch standard options are supported in this polyfill. For instance, `redirect` and <code>cache</code> directives are ignored.</li>
<li><code>keepalive</code> is not supported because it would involve making a synchronous XHR, which is something this project is not willing to do. See <a href="https://github.com/github/fetch/issues/700#issuecomment-484188326">issue #700</a> for more information.</li>
</ul>
<h3><a class="anchor" id="autotoc_md27160"></a>
Handling HTTP error statuses</h3>
<p>To have <code>fetch</code> Promise reject on HTTP error statuses, i.e. on any non-2xx status, define a custom response handler:</p>
<div class="fragment"><div class="line">function checkStatus(response) {</div>
<div class="line">  if (response.status &gt;= 200 &amp;&amp; response.status &lt; 300) {</div>
<div class="line">    return response</div>
<div class="line">  } else {</div>
<div class="line">    var error = new Error(response.statusText)</div>
<div class="line">    error.response = response</div>
<div class="line">    throw error</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">function parseJSON(response) {</div>
<div class="line">  return response.json()</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">fetch(&#39;/users&#39;)</div>
<div class="line">  .then(checkStatus)</div>
<div class="line">  .then(parseJSON)</div>
<div class="line">  .then(function(data) {</div>
<div class="line">    console.log(&#39;request succeeded with JSON response&#39;, data)</div>
<div class="line">  }).catch(function(error) {</div>
<div class="line">    console.log(&#39;request failed&#39;, error)</div>
<div class="line">  })</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md27161"></a>
Sending cookies</h3>
<p>For <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS" title="Cross-origin resource sharing">CORS</a> requests, use &lsquo;credentials: 'include&rsquo;` to allow sending credentials to other domains:</p>
<div class="fragment"><div class="line">fetch(&#39;https://example.com:1234/users&#39;, {</div>
<div class="line">  credentials: &#39;include&#39;</div>
<div class="line">})</div>
</div><!-- fragment --><p>The default value for <code>credentials</code> is "same-origin".</p>
<p>The default for <code>credentials</code> wasn't always the same, though. The following versions of browsers implemented an older version of the fetch specification where the default was "omit":</p>
<ul>
<li>Firefox 39-60</li>
<li>Chrome 42-67</li>
<li>Safari 10.1-11.1.2</li>
</ul>
<p>If you target these browsers, it's advisable to always specify &lsquo;credentials: 'same-origin&rsquo;` explicitly with all fetch requests instead of relying on the default:</p>
<div class="fragment"><div class="line">fetch(&#39;/users&#39;, {</div>
<div class="line">  credentials: &#39;same-origin&#39;</div>
<div class="line">})</div>
</div><!-- fragment --><p>Note: due to <a href="https://github.com/github/fetch/pull/56#issuecomment-68835992">limitations of XMLHttpRequest</a>, using &lsquo;credentials: 'omit&rsquo;` is not respected for same domains in browsers where this polyfill is active. Cookies will always be sent to same domains in older browsers.</p>
<h3><a class="anchor" id="autotoc_md27162"></a>
Receiving cookies</h3>
<p>As with XMLHttpRequest, the <code>Set-Cookie</code> response header returned from the server is a <a href="https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_header_name">forbidden header name</a> and therefore can't be programmatically read with <code>response.headers.get()</code>. Instead, it's the browser's responsibility to handle new cookies being set (if applicable to the current URL). Unless they are HTTP-only, new cookies will be available through <code>document.cookie</code>.</p>
<h3><a class="anchor" id="autotoc_md27163"></a>
Redirect modes</h3>
<p>The Fetch specification defines these values for <a href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode">the <code>redirect</code> option</a>: "follow" (the default), "error", and "manual".</p>
<p>Due to limitations of XMLHttpRequest, only the "follow" mode is available in browsers where this polyfill is active.</p>
<h3><a class="anchor" id="autotoc_md27164"></a>
Obtaining the Response URL</h3>
<p>Due to limitations of XMLHttpRequest, the <code>response.url</code> value might not be reliable after HTTP redirects on older browsers.</p>
<p>The solution is to configure the server to set the response HTTP header <code>X-Request-URL</code> to the current URL after any redirect that might have happened. It should be safe to set it unconditionally.</p>
<div class="fragment"><div class="line"> ruby</div>
<div class="line"># Ruby on Rails controller example</div>
<div class="line">response.headers[&#39;X-Request-URL&#39;] = request.url</div>
</div><!-- fragment --><p>This server workaround is necessary if you need reliable <code>response.url</code> in Firefox &lt; 32, Chrome &lt; 37, Safari, or IE.</p>
<h3><a class="anchor" id="autotoc_md27165"></a>
Aborting requests</h3>
<p>This polyfill supports <a href="https://developers.google.com/web/updates/2017/09/abortable-fetch">the abortable fetch API</a>. However, aborting a fetch requires use of two additional DOM APIs: <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController">AbortController</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal">AbortSignal</a>. Typically, browsers that do not support fetch will also not support AbortController or AbortSignal. Consequently, you will need to include <a href="https://www.npmjs.com/package/yet-another-abortcontroller-polyfill">an additional polyfill</a> for these APIs to abort fetches:</p>
<div class="fragment"><div class="line">import &#39;yet-another-abortcontroller-polyfill&#39;</div>
<div class="line">import {fetch} from &#39;whatwg-fetch&#39;</div>
<div class="line"> </div>
<div class="line">// use native browser implementation if it supports aborting</div>
<div class="line">const abortableFetch = (&#39;signal&#39; in new Request(&#39;&#39;)) ? window.fetch : fetch</div>
<div class="line"> </div>
<div class="line">const controller = new AbortController()</div>
<div class="line"> </div>
<div class="line">abortableFetch(&#39;/avatars&#39;, {</div>
<div class="line">  signal: controller.signal</div>
<div class="line">}).catch(function(ex) {</div>
<div class="line">  if (ex.name === &#39;AbortError&#39;) {</div>
<div class="line">    console.log(&#39;request aborted&#39;)</div>
<div class="line">  }</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// some time later...</div>
<div class="line">controller.abort()</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md27166"></a>
Browser Support</h1>
<ul>
<li>Chrome</li>
<li>Firefox</li>
<li>Safari 6.1+</li>
<li>Internet Explorer 10+</li>
</ul>
<p>Note: modern browsers such as Chrome, Firefox, Microsoft Edge, and Safari contain native implementations of <code>window.fetch</code>, therefore the code from this polyfill doesn't have any effect on those browsers. If you believe you've encountered an error with how <code>window.fetch</code> is implemented in any of these browsers, you should file an issue with that browser vendor instead of this project. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
