<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AREA: mquery</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AREA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">mquery</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md31112"></a> <code>mquery</code> is a fluent mongodb query builder designed to run in multiple environments.</p>
<p><a href="https://travis-ci.org/aheckmann/mquery"><img src="https://travis-ci.org/aheckmann/mquery.svg?branch=master" alt="Build Status" style="pointer-events: none;" class="inline"/></a> <a href="http://badge.fury.io/js/mquery"><img src="https://badge.fury.io/js/mquery.svg" alt="NPM version" style="pointer-events: none;" class="inline"/></a></p>
<p><a href="https://www.npmjs.com/package/mquery"><img src="https://nodei.co/npm/mquery.png" alt="npm" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md31113"></a>
Features</h1>
<ul>
<li>fluent query builder api</li>
<li>custom base query support</li>
<li>MongoDB 2.4 geoJSON support</li>
<li>method + option combinations validation</li>
<li>node.js driver compatibility</li>
<li>environment detection</li>
<li><a href="https://github.com/visionmedia/debug">debug</a> support</li>
<li>separated collection implementations for maximum flexibility</li>
</ul>
<h1><a class="anchor" id="autotoc_md31114"></a>
Use</h1>
<div class="fragment"><div class="line">const mongo = require(&#39;mongodb&#39;);</div>
<div class="line"> </div>
<div class="line">const client = new mongo.MongoClient(uri);</div>
<div class="line">await client.connect();</div>
<div class="line">// get a collection</div>
<div class="line">const collection = client.collection(&#39;artists&#39;);</div>
<div class="line"> </div>
<div class="line">// pass it to the constructor</div>
<div class="line">await mquery(collection).find({...});</div>
<div class="line"> </div>
<div class="line">// or pass it to the collection method</div>
<div class="line">const docs = await mquery().find({...}).collection(collection);</div>
<div class="line"> </div>
<div class="line">// or better yet, create a custom query constructor that has it always set</div>
<div class="line">const Artist = mquery(collection).toConstructor();</div>
<div class="line">const docs = await Artist().find(...).where(...);</div>
</div><!-- fragment --><p><code>mquery</code> requires a collection object to work with. In the example above we just pass the collection object created using the official <a href="https://github.com/mongodb/node-mongodb-native">MongoDB driver</a>.</p>
<h1><a class="anchor" id="autotoc_md31115"></a>
Fluent API</h1>
<ul>
<li>mquery<ul>
<li>Features</li>
<li>Use</li>
<li>Fluent API</li>
<li>Helpers<ul>
<li>find()</li>
<li>findOne()</li>
<li>count()</li>
<li>findOneAndUpdate()<ul>
<li>findOneAndUpdate() options</li>
</ul>
</li>
<li>findOneAndRemove()<ul>
<li>findOneAndRemove() options</li>
</ul>
</li>
<li>distinct()</li>
<li>exec()</li>
<li>stream()</li>
<li>all()</li>
<li>and()</li>
<li>box()</li>
<li>circle()</li>
<li>elemMatch()</li>
<li>equals()</li>
<li>exists()</li>
<li>geometry()</li>
<li>gt()</li>
<li>gte()</li>
<li>in()</li>
<li>intersects()</li>
<li>lt()</li>
<li>lte()</li>
<li>maxDistance()</li>
<li>mod()</li>
<li>ne()</li>
<li>nin()</li>
<li>nor()</li>
<li>near()<ul>
<li>Example</li>
</ul>
</li>
<li>or()</li>
<li>polygon()</li>
<li>regex()</li>
<li>select()<ul>
<li>String syntax</li>
</ul>
</li>
<li>selected()</li>
<li>selectedInclusively()</li>
<li>selectedExclusively()</li>
<li>size()</li>
<li>slice()</li>
<li>within()</li>
<li>where()</li>
<li>$where()</li>
<li>batchSize()</li>
<li>collation()</li>
<li>comment()</li>
<li>hint()</li>
<li>j()</li>
<li>limit()</li>
<li>maxTime()</li>
<li>skip()</li>
<li>sort()</li>
<li>read()<ul>
<li>Preferences:</li>
<li>Preference Tags:</li>
</ul>
</li>
<li>readConcern()<ul>
<li>Read Concern Level:</li>
</ul>
</li>
<li>writeConcern()<ul>
<li>Write Concern:</li>
</ul>
</li>
<li>slaveOk()</li>
<li>tailable()</li>
<li>wtimeout()</li>
</ul>
</li>
<li>Helpers<ul>
<li>collection()</li>
<li>then()</li>
<li>merge(object)</li>
<li>setOptions(options)<ul>
<li>setOptions() options</li>
</ul>
</li>
<li>setTraceFunction(func)</li>
<li>mquery.setGlobalTraceFunction(func)</li>
<li>mquery.canMerge(conditions)</li>
</ul>
</li>
<li>mquery.use$geoWithin</li>
<li>Custom Base Queries</li>
<li>Validation</li>
<li>Debug support</li>
<li>General compatibility<ul>
<li>ObjectIds</li>
<li>Read Preferences</li>
</ul>
</li>
<li>Future goals</li>
<li><a class="el" href="md_web_2node__modules_2web-vitals_2README.html#installation">Installation</a></li>
<li>License</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md31116"></a>
Helpers</h1>
<ul>
<li>collection</li>
<li>then</li>
<li>merge</li>
<li>setOptions</li>
<li>setTraceFunction</li>
<li>mquery.setGlobalTraceFunction</li>
<li>mquery.canMerge</li>
<li>mquery.use$geoWithin</li>
</ul>
<h2><a class="anchor" id="autotoc_md31117"></a>
find()</h2>
<p>Declares this query a <em>find</em> query. Optionally pass a match clause.</p>
<div class="fragment"><div class="line">mquery().find()</div>
<div class="line">mquery().find(match)</div>
<div class="line">await mquery().find()</div>
<div class="line">const docs = await mquery().find(match);</div>
<div class="line">assert(Array.isArray(docs));</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31118"></a>
findOne()</h2>
<p>Declares this query a <em>findOne</em> query. Optionally pass a match clause.</p>
<div class="fragment"><div class="line">mquery().findOne()</div>
<div class="line">mquery().findOne(match)</div>
<div class="line">await mquery().findOne()</div>
<div class="line">const doc = await mquery().findOne(match);</div>
<div class="line">if (doc) {</div>
<div class="line">  // the document may not be found</div>
<div class="line">  console.log(doc);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31119"></a>
count()</h2>
<p>Declares this query a <em>count</em> query. Optionally pass a match clause.</p>
<div class="fragment"><div class="line">mquery().count()</div>
<div class="line">mquery().count(match)</div>
<div class="line">await mquery().count()</div>
<div class="line">const number = await mquery().count(match);</div>
<div class="line">console.log(&#39;we found %d matching documents&#39;, number);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31120"></a>
findOneAndUpdate()</h2>
<p>Declares this query a <em>findAndModify</em> with update query. Optionally pass a match clause, update document, options.</p>
<p>When executed, the first matching document (if found) is modified according to the update document and passed back.</p>
<h3><a class="anchor" id="autotoc_md31121"></a>
findOneAndUpdate() options</h3>
<p>Options are passed to the <code>setOptions()</code> method.</p>
<ul>
<li><code>returnDocument</code>: string - &lsquo;'after&rsquo;<code>to return the modified document rather than the original. defaults to</code>'before'<code> -</code>upsert<code>: boolean - creates the object if it doesn't exist. defaults to false -</code>sort`: if multiple docs are found by the match condition, sets the sort order to choose which doc to update</li>
</ul>
<div class="fragment"><div class="line">query.findOneAndUpdate()</div>
<div class="line">query.findOneAndUpdate(updateDocument)</div>
<div class="line">query.findOneAndUpdate(match, updateDocument)</div>
<div class="line">query.findOneAndUpdate(match, updateDocument, options)</div>
<div class="line"> </div>
<div class="line">// the following all execute the command</div>
<div class="line">await query.findOneAndUpdate()</div>
<div class="line">await query.findOneAndUpdate(updateDocument)</div>
<div class="line">await query.findOneAndUpdate(match, updateDocument)</div>
<div class="line">const doc = await await query.findOneAndUpdate(match, updateDocument, options);</div>
<div class="line">if (doc) {</div>
<div class="line">  // the document may not be found</div>
<div class="line">  console.log(doc);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31122"></a>
findOneAndRemove()</h2>
<p>Declares this query a <em>findAndModify</em> with remove query. Alias of findOneAndDelete. Optionally pass a match clause, options.</p>
<p>When executed, the first matching document (if found) is modified according to the update document, removed from the collection and passed as a result.</p>
<h3><a class="anchor" id="autotoc_md31123"></a>
findOneAndRemove() options</h3>
<p>Options are passed to the <code>setOptions()</code> method.</p>
<ul>
<li><code>sort</code>: if multiple docs are found by the condition, sets the sort order to choose which doc to modify and remove</li>
</ul>
<div class="fragment"><div class="line">A.where().findOneAndDelete()</div>
<div class="line">A.where().findOneAndRemove()</div>
<div class="line">A.where().findOneAndRemove(match)</div>
<div class="line">A.where().findOneAndRemove(match, options)</div>
<div class="line"> </div>
<div class="line">// the following all execute the command</div>
<div class="line">await A.where().findOneAndRemove()</div>
<div class="line">await A.where().findOneAndRemove(match)</div>
<div class="line">const doc = await A.where().findOneAndRemove(match, options);</div>
<div class="line">if (doc) {</div>
<div class="line">  // the document may not be found</div>
<div class="line">  console.log(doc);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31124"></a>
distinct()</h2>
<p>Declares this query a <em>distinct</em> query. Optionally pass the distinct field, a match clause.</p>
<div class="fragment"><div class="line">mquery().distinct()</div>
<div class="line">mquery().distinct(match)</div>
<div class="line">mquery().distinct(match, field)</div>
<div class="line">mquery().distinct(field)</div>
<div class="line"> </div>
<div class="line">// the following all execute the command</div>
<div class="line">await mquery().distinct()</div>
<div class="line">await mquery().distinct(field)</div>
<div class="line">await mquery().distinct(match)</div>
<div class="line">const result = await mquery().distinct(match, field);</div>
<div class="line">console.log(result);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31125"></a>
exec()</h2>
<p>Executes the query.</p>
<div class="fragment"><div class="line">const docs = await mquery().findOne().where(&#39;route&#39;).intersects(polygon).exec()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31126"></a>
stream()</h2>
<p>Executes the query and returns a stream.</p>
<div class="fragment"><div class="line">var stream = mquery().find().stream(options);</div>
<div class="line">stream.on(&#39;data&#39;, cb);</div>
<div class="line">stream.on(&#39;close&#39;, fn);</div>
</div><!-- fragment --><p>Note: this only works with <code>find()</code> operations.</p>
<p>Note: returns the stream object directly from the node-mongodb-native driver. (currently streams1 type stream). Any options will be passed along to the <a href="http://mongodb.github.io/node-mongodb-native/api-generated/cursor.html#stream">driver method</a>.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md31128"></a>
all()</h2>
<p>Specifies an <code>$all</code> query condition</p>
<div class="fragment"><div class="line">mquery().where(&#39;permission&#39;).all([&#39;read&#39;, &#39;write&#39;])</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/all/">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31129"></a>
and()</h2>
<p>Specifies arguments for an <code>$and</code> condition</p>
<div class="fragment"><div class="line">mquery().and([{ color: &#39;green&#39; }, { status: &#39;ok&#39; }])</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/and/">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31130"></a>
box()</h2>
<p>Specifies a <code>$box</code> condition</p>
<div class="fragment"><div class="line">var lowerLeft = [40.73083, -73.99756]</div>
<div class="line">var upperRight= [40.741404,  -73.988135]</div>
<div class="line"> </div>
<div class="line">mquery().where(&#39;location&#39;).within().box(lowerLeft, upperRight)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/box/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31131"></a>
circle()</h2>
<p>Specifies a <code>$center</code> or <code>$centerSphere</code> condition.</p>
<div class="fragment"><div class="line">var area = { center: [50, 50], radius: 10, unique: true }</div>
<div class="line">query.where(&#39;loc&#39;).within().circle(area)</div>
<div class="line">query.circle(&#39;loc&#39;, area);</div>
<div class="line"> </div>
<div class="line">// for spherical calculations</div>
<div class="line">var area = { center: [50, 50], radius: 10, unique: true, spherical: true }</div>
<div class="line">query.where(&#39;loc&#39;).within().circle(area)</div>
<div class="line">query.circle(&#39;loc&#39;, area);</div>
</div><!-- fragment --><ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/center/">MongoDB Documentation - center</a></li>
<li><a href="http://docs.mongodb.org/manual/reference/operator/centerSphere/">MongoDB Documentation - centerSphere</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md31132"></a>
elemMatch()</h2>
<p>Specifies an <code>$elemMatch</code> condition</p>
<div class="fragment"><div class="line">query.where(&#39;comment&#39;).elemMatch({ author: &#39;autobot&#39;, votes: {$gte: 5}})</div>
<div class="line"> </div>
<div class="line">query.elemMatch(&#39;comment&#39;, function (elem) {</div>
<div class="line">  elem.where(&#39;author&#39;).equals(&#39;autobot&#39;);</div>
<div class="line">  elem.where(&#39;votes&#39;).gte(5);</div>
<div class="line">})</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/elemMatch/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31133"></a>
equals()</h2>
<p>Specifies the complementary comparison value for the path specified with <code>where()</code>.</p>
<div class="fragment"><div class="line">mquery().where(&#39;age&#39;).equals(49);</div>
<div class="line"> </div>
<div class="line">// is the same as</div>
<div class="line"> </div>
<div class="line">mquery().where({ &#39;age&#39;: 49 });</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31134"></a>
exists()</h2>
<p>Specifies an <code>$exists</code> condition</p>
<div class="fragment"><div class="line">// { name: { $exists: true }}</div>
<div class="line">mquery().where(&#39;name&#39;).exists()</div>
<div class="line">mquery().where(&#39;name&#39;).exists(true)</div>
<div class="line">mquery().exists(&#39;name&#39;)</div>
<div class="line"> </div>
<div class="line">// { name: { $exists: false }}</div>
<div class="line">mquery().where(&#39;name&#39;).exists(false);</div>
<div class="line">mquery().exists(&#39;name&#39;, false);</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/exists/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31135"></a>
geometry()</h2>
<p>Specifies a <code>$geometry</code> condition</p>
<div class="fragment"><div class="line">var polyA = [[[ 10, 20 ], [ 10, 40 ], [ 30, 40 ], [ 30, 20 ]]]</div>
<div class="line">query.where(&#39;loc&#39;).within().geometry({ type: &#39;Polygon&#39;, coordinates: polyA })</div>
<div class="line"> </div>
<div class="line">// or</div>
<div class="line">var polyB = [[ 0, 0 ], [ 1, 1 ]]</div>
<div class="line">query.where(&#39;loc&#39;).within().geometry({ type: &#39;LineString&#39;, coordinates: polyB })</div>
<div class="line"> </div>
<div class="line">// or</div>
<div class="line">var polyC = [ 0, 0 ]</div>
<div class="line">query.where(&#39;loc&#39;).within().geometry({ type: &#39;Point&#39;, coordinates: polyC })</div>
<div class="line"> </div>
<div class="line">// or</div>
<div class="line">query.where(&#39;loc&#39;).intersects().geometry({ type: &#39;Point&#39;, coordinates: polyC })</div>
<div class="line"> </div>
<div class="line">// or</div>
<div class="line">query.where(&#39;loc&#39;).near().geometry({ type: &#39;Point&#39;, coordinates: [3,5] })</div>
</div><!-- fragment --><p><code>geometry()</code> <b>must</b> come after <code>intersects()</code>, <code>within()</code>, or <code>near()</code>.</p>
<p>The <code>object</code> argument must contain <code>type</code> and <code>coordinates</code> properties.</p>
<ul>
<li>type <code>String</code></li>
<li>coordinates <code>Array</code></li>
</ul>
<p><a href="http://docs.mongodb.org/manual/reference/operator/geometry/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31136"></a>
gt()</h2>
<p>Specifies a <code>$gt</code> query condition.</p>
<div class="fragment"><div class="line">mquery().where(&#39;clicks&#39;).gt(999)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/gt/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31137"></a>
gte()</h2>
<p>Specifies a <code>$gte</code> query condition.</p>
<p><a href="http://docs.mongodb.org/manual/reference/operator/gte/">MongoDB Documentation</a></p>
<div class="fragment"><div class="line">mquery().where(&#39;clicks&#39;).gte(1000)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31138"></a>
in()</h2>
<p>Specifies an <code>$in</code> query condition.</p>
<div class="fragment"><div class="line">mquery().where(&#39;author_id&#39;).in([3, 48901, 761])</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/in/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31139"></a>
intersects()</h2>
<p>Declares an <code>$geoIntersects</code> query for <code>geometry()</code>.</p>
<div class="fragment"><div class="line">query.where(&#39;path&#39;).intersects().geometry({</div>
<div class="line">    type: &#39;LineString&#39;</div>
<div class="line">  , coordinates: [[180.0, 11.0], [180, 9.0]]</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// geometry arguments are supported</div>
<div class="line">query.where(&#39;path&#39;).intersects({</div>
<div class="line">    type: &#39;LineString&#39;</div>
<div class="line">  , coordinates: [[180.0, 11.0], [180, 9.0]]</div>
<div class="line">})</div>
</div><!-- fragment --><p><b>Must</b> be used after <code>where()</code>.</p>
<p><a href="http://docs.mongodb.org/manual/reference/operator/geoIntersects/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31140"></a>
lt()</h2>
<p>Specifies a <code>$lt</code> query condition.</p>
<div class="fragment"><div class="line">mquery().where(&#39;clicks&#39;).lt(50)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/lt/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31141"></a>
lte()</h2>
<p>Specifies a <code>$lte</code> query condition.</p>
<div class="fragment"><div class="line">mquery().where(&#39;clicks&#39;).lte(49)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/lte/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31142"></a>
maxDistance()</h2>
<p>Specifies a <code>$maxDistance</code> query condition.</p>
<div class="fragment"><div class="line">mquery().where(&#39;location&#39;).near({ center: [139, 74.3] }).maxDistance(5)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/maxDistance/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31143"></a>
mod()</h2>
<p>Specifies a <code>$mod</code> condition</p>
<div class="fragment"><div class="line">mquery().where(&#39;count&#39;).mod(2, 0)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/mod/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31144"></a>
ne()</h2>
<p>Specifies a <code>$ne</code> query condition.</p>
<div class="fragment"><div class="line">mquery().where(&#39;status&#39;).ne(&#39;ok&#39;)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/ne/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31145"></a>
nin()</h2>
<p>Specifies an <code>$nin</code> query condition.</p>
<div class="fragment"><div class="line">mquery().where(&#39;author_id&#39;).nin([3, 48901, 761])</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/nin/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31146"></a>
nor()</h2>
<p>Specifies arguments for an <code>$nor</code> condition.</p>
<div class="fragment"><div class="line">mquery().nor([{ color: &#39;green&#39; }, { status: &#39;ok&#39; }])</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/nor/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31147"></a>
near()</h2>
<p>Specifies arguments for a <code>$near</code> or <code>$nearSphere</code> condition.</p>
<p>These operators return documents sorted by distance.</p>
<h3><a class="anchor" id="autotoc_md31148"></a>
Example</h3>
<div class="fragment"><div class="line">query.where(&#39;loc&#39;).near({ center: [10, 10] });</div>
<div class="line">query.where(&#39;loc&#39;).near({ center: [10, 10], maxDistance: 5 });</div>
<div class="line">query.near(&#39;loc&#39;, { center: [10, 10], maxDistance: 5 });</div>
<div class="line"> </div>
<div class="line">// GeoJSON</div>
<div class="line">query.where(&#39;loc&#39;).near({ center: { type: &#39;Point&#39;, coordinates: [10, 10] }});</div>
<div class="line">query.where(&#39;loc&#39;).near({ center: { type: &#39;Point&#39;, coordinates: [10, 10] }, maxDistance: 5, spherical: true });</div>
<div class="line">query.where(&#39;loc&#39;).near().geometry({ type: &#39;Point&#39;, coordinates: [10, 10] });</div>
<div class="line"> </div>
<div class="line">// For a $nearSphere condition, pass the `spherical` option.</div>
<div class="line">query.near({ center: [10, 10], maxDistance: 5, spherical: true });</div>
</div><!-- fragment --><p><a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31149"></a>
or()</h2>
<p>Specifies arguments for an <code>$or</code> condition.</p>
<div class="fragment"><div class="line">mquery().or([{ color: &#39;red&#39; }, { status: &#39;emergency&#39; }])</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/or/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31150"></a>
polygon()</h2>
<p>Specifies a <code>$polygon</code> condition</p>
<div class="fragment"><div class="line">mquery().where(&#39;loc&#39;).within().polygon([10,20], [13, 25], [7,15])</div>
<div class="line">mquery().polygon(&#39;loc&#39;, [10,20], [13, 25], [7,15])</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/polygon/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31151"></a>
regex()</h2>
<p>Specifies a <code>$regex</code> query condition.</p>
<div class="fragment"><div class="line">mquery().where(&#39;name&#39;).regex(/^sixstepsrecords/)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/regex/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31152"></a>
select()</h2>
<p>Specifies which document fields to include or exclude</p>
<div class="fragment"><div class="line">// 1 means include, 0 means exclude</div>
<div class="line">mquery().select({ name: 1, address: 1, _id: 0 })</div>
<div class="line"> </div>
<div class="line">// or</div>
<div class="line"> </div>
<div class="line">mquery().select(&#39;name address -_id&#39;)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md31153"></a>
String syntax</h3>
<p>When passing a string, prefixing a path with <code>-</code> will flag that path as excluded. When a path does not have the <code>-</code> prefix, it is included.</p>
<div class="fragment"><div class="line">// include a and b, exclude c</div>
<div class="line">query.select(&#39;a b -c&#39;);</div>
<div class="line"> </div>
<div class="line">// or you may use object notation, useful when</div>
<div class="line">// you have keys already prefixed with a &quot;-&quot;</div>
<div class="line">query.select({a: 1, b: 1, c: 0});</div>
</div><!-- fragment --><p><em>Cannot be used with <code>distinct()</code>.</em></p>
<h2><a class="anchor" id="autotoc_md31154"></a>
selected()</h2>
<p>Determines if the query has selected any fields.</p>
<div class="fragment"><div class="line">var query = mquery();</div>
<div class="line">query.selected() // false</div>
<div class="line">query.select(&#39;-name&#39;);</div>
<div class="line">query.selected() // true</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31155"></a>
selectedInclusively()</h2>
<p>Determines if the query has selected any fields inclusively.</p>
<div class="fragment"><div class="line">var query = mquery().select(&#39;name&#39;);</div>
<div class="line">query.selectedInclusively() // true</div>
<div class="line"> </div>
<div class="line">var query = mquery();</div>
<div class="line">query.selected() // false</div>
<div class="line">query.select(&#39;-name&#39;);</div>
<div class="line">query.selectedInclusively() // false</div>
<div class="line">query.selectedExclusively() // true</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31156"></a>
selectedExclusively()</h2>
<p>Determines if the query has selected any fields exclusively.</p>
<div class="fragment"><div class="line">var query = mquery().select(&#39;-name&#39;);</div>
<div class="line">query.selectedExclusively() // true</div>
<div class="line"> </div>
<div class="line">var query = mquery();</div>
<div class="line">query.selected() // false</div>
<div class="line">query.select(&#39;name&#39;);</div>
<div class="line">query.selectedExclusively() // false</div>
<div class="line">query.selectedInclusively() // true</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31157"></a>
size()</h2>
<p>Specifies a <code>$size</code> query condition.</p>
<div class="fragment"><div class="line">mquery().where(&#39;someArray&#39;).size(6)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/operator/size/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31158"></a>
slice()</h2>
<p>Specifies a <code>$slice</code> projection for a <code>path</code></p>
<div class="fragment"><div class="line">mquery().where(&#39;comments&#39;).slice(5)</div>
<div class="line">mquery().where(&#39;comments&#39;).slice(-5)</div>
<div class="line">mquery().where(&#39;comments&#39;).slice([-10, 5])</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/projection/slice/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31159"></a>
within()</h2>
<p>Sets a <code>$geoWithin</code> or <code>$within</code> argument for geo-spatial queries.</p>
<div class="fragment"><div class="line">mquery().within().box()</div>
<div class="line">mquery().within().circle()</div>
<div class="line">mquery().within().geometry()</div>
<div class="line"> </div>
<div class="line">mquery().where(&#39;loc&#39;).within({ center: [50,50], radius: 10, unique: true, spherical: true });</div>
<div class="line">mquery().where(&#39;loc&#39;).within({ box: [[40.73, -73.9], [40.7, -73.988]] });</div>
<div class="line">mquery().where(&#39;loc&#39;).within({ polygon: [[],[],[],[]] });</div>
<div class="line"> </div>
<div class="line">mquery().where(&#39;loc&#39;).within([], [], []) // polygon</div>
<div class="line">mquery().where(&#39;loc&#39;).within([], []) // box</div>
<div class="line">mquery().where(&#39;loc&#39;).within({ type: &#39;LineString&#39;, coordinates: [...] }); // geometry</div>
</div><!-- fragment --><p>As of mquery 2.0, <code>$geoWithin</code> is used by default. This impacts you if running MongoDB &lt; 2.4. To alter this behavior, see mquery.use$geoWithin.</p>
<p><b>Must</b> be used after <code>where()</code>.</p>
<p><a href="http://docs.mongodb.org/manual/reference/operator/geoWithin/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31160"></a>
where()</h2>
<p>Specifies a <code>path</code> for use with chaining</p>
<div class="fragment"><div class="line">// instead of writing:</div>
<div class="line">mquery().find({age: {$gte: 21, $lte: 65}});</div>
<div class="line"> </div>
<div class="line">// we can instead write:</div>
<div class="line">mquery().where(&#39;age&#39;).gte(21).lte(65);</div>
<div class="line"> </div>
<div class="line">// passing query conditions is permitted too</div>
<div class="line">mquery().find().where({ name: &#39;vonderful&#39; })</div>
<div class="line"> </div>
<div class="line">// chaining</div>
<div class="line">await mquery()</div>
<div class="line">  .where(&#39;age&#39;).gte(21).lte(65)</div>
<div class="line">  .where({ &#39;name&#39;: /^vonderful/i })</div>
<div class="line">  .where(&#39;friends&#39;).slice(10)</div>
<div class="line">  .exec()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31161"></a>
$where()</h2>
<p>Specifies a <code>$where</code> condition.</p>
<p>Use <code>$where</code> when you need to select documents using a JavaScript expression.</p>
<div class="fragment"><div class="line">await query.$where(&#39;this.comments.length &gt; 10 || this.name.length &gt; 5&#39;).exec()</div>
<div class="line"> </div>
<div class="line">query.$where(function () {</div>
<div class="line">  return this.comments.length &gt; 10 || this.name.length &gt; 5;</div>
<div class="line">})</div>
</div><!-- fragment --><p>Only use <code>$where</code> when you have a condition that cannot be met using other MongoDB operators like <code>$lt</code>. Be sure to read about all of <a href="http://docs.mongodb.org/manual/reference/operator/where/">its caveats</a> before using.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md31163"></a>
batchSize()</h2>
<p>Specifies the batchSize option.</p>
<div class="fragment"><div class="line">query.batchSize(100)</div>
</div><!-- fragment --><p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/method/cursor.batchSize/">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31164"></a>
collation()</h2>
<p>Specifies the collation option.</p>
<div class="fragment"><div class="line">query.collation({ locale: &quot;en_US&quot;, strength: 1 })</div>
</div><!-- fragment --><p><a href="https://docs.mongodb.com/manual/reference/method/cursor.collation/#cursor.collation">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31165"></a>
comment()</h2>
<p>Specifies the comment option.</p>
<div class="fragment"><div class="line">query.comment(&#39;login query&#39;);</div>
</div><!-- fragment --><p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/operator/">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31166"></a>
hint()</h2>
<p>Sets query hints.</p>
<div class="fragment"><div class="line">mquery().hint({ indexA: 1, indexB: -1 })</div>
</div><!-- fragment --><p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/operator/hint/">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31167"></a>
j()</h2>
<p>Requests acknowledgement that this operation has been persisted to MongoDB's on-disk journal.</p>
<p>This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to the <code>j</code> value if it is specified in writeConcern</p>
<div class="fragment"><div class="line">mquery().j(true);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31168"></a>
limit()</h2>
<p>Specifies the limit option.</p>
<div class="fragment"><div class="line">query.limit(20)</div>
</div><!-- fragment --><p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/method/cursor.limit/">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31169"></a>
maxTime()</h2>
<p>Specifies the maxTimeMS option.</p>
<div class="fragment"><div class="line">query.maxTime(100)</div>
<div class="line">query.maxTimeMS(100)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/method/cursor.maxTimeMS/">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31170"></a>
skip()</h2>
<p>Specifies the skip option.</p>
<div class="fragment"><div class="line">query.skip(100).limit(20)</div>
</div><!-- fragment --><p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/method/cursor.skip/">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31171"></a>
sort()</h2>
<p>Sets the query sort order.</p>
<p>If an object is passed, key values allowed are <code>asc</code>, <code>desc</code>, <code>ascending</code>, <code>descending</code>, <code>1</code>, and <code>-1</code>.</p>
<p>If a string is passed, it must be a space delimited list of path names. The sort order of each path is ascending unless the path name is prefixed with <code>-</code> which will be treated as descending.</p>
<div class="fragment"><div class="line">// these are equivalent</div>
<div class="line">query.sort({ field: &#39;asc&#39;, test: -1 });</div>
<div class="line">query.sort(&#39;field -test&#39;);</div>
</div><!-- fragment --><p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/method/cursor.sort/">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31172"></a>
read()</h2>
<p>Sets the readPreference option for the query.</p>
<div class="fragment"><div class="line">mquery().read(&#39;primary&#39;)</div>
<div class="line">mquery().read(&#39;p&#39;)  // same as primary</div>
<div class="line"> </div>
<div class="line">mquery().read(&#39;primaryPreferred&#39;)</div>
<div class="line">mquery().read(&#39;pp&#39;) // same as primaryPreferred</div>
<div class="line"> </div>
<div class="line">mquery().read(&#39;secondary&#39;)</div>
<div class="line">mquery().read(&#39;s&#39;)  // same as secondary</div>
<div class="line"> </div>
<div class="line">mquery().read(&#39;secondaryPreferred&#39;)</div>
<div class="line">mquery().read(&#39;sp&#39;) // same as secondaryPreferred</div>
<div class="line"> </div>
<div class="line">mquery().read(&#39;nearest&#39;)</div>
<div class="line">mquery().read(&#39;n&#39;)  // same as nearest</div>
<div class="line"> </div>
<div class="line">mquery().setReadPreference(&#39;primary&#39;) // alias of .read()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md31173"></a>
Preferences:</h3>
<ul>
<li><code>primary</code> - (default) Read from primary only. Operations will produce an error if primary is unavailable. Cannot be combined with tags.</li>
<li><code>secondary</code> - Read from secondary if available, otherwise error.</li>
<li><code>primaryPreferred</code> - Read from primary if available, otherwise a secondary.</li>
<li><code>secondaryPreferred</code> - Read from a secondary if available, otherwise read from the primary.</li>
<li><code>nearest</code> - All operations read from among the nearest candidates, but unlike other modes, this option will include both the primary and all secondaries in the random selection.</li>
</ul>
<p>Aliases</p>
<ul>
<li><code>p</code> primary</li>
<li><code>pp</code> primaryPreferred</li>
<li><code>s</code> secondary</li>
<li><code>sp</code> secondaryPreferred</li>
<li><code>n</code> nearest</li>
</ul>
<h3><a class="anchor" id="autotoc_md31174"></a>
Preference Tags:</h3>
<p>To keep the separation of concerns between <code>mquery</code> and your driver clean, <code>mquery#read()</code> no longer handles specifying a second <code>tags</code> argument as of version 0.5. If you need to specify tags, pass any non-string argument as the first argument. <code>mquery</code> will pass this argument untouched to your collections methods later. For example:</p>
<div class="fragment"><div class="line">// example of specifying tags using the Node.js driver</div>
<div class="line">var ReadPref = require(&#39;mongodb&#39;).ReadPreference;</div>
<div class="line">var preference = new ReadPref(&#39;secondary&#39;, [{ dc:&#39;sf&#39;, s: 1 },{ dc:&#39;ma&#39;, s: 2 }]);</div>
<div class="line">mquery(...).read(preference).exec();</div>
</div><!-- fragment --><p>Read more about how to use read preferences <a href="http://docs.mongodb.org/manual/applications/replication/#read-preference">here</a> and <a href="http://mongodb.github.com/node-mongodb-native/driver-articles/anintroductionto1_1and2_2.html#read-preferences">here</a>.</p>
<h2><a class="anchor" id="autotoc_md31175"></a>
readConcern()</h2>
<p>Sets the readConcern option for the query.</p>
<div class="fragment"><div class="line">// local</div>
<div class="line">mquery().readConcern(&#39;local&#39;)</div>
<div class="line">mquery().readConcern(&#39;l&#39;)</div>
<div class="line">mquery().r(&#39;l&#39;)</div>
<div class="line"> </div>
<div class="line">// available</div>
<div class="line">mquery().readConcern(&#39;available&#39;)</div>
<div class="line">mquery().readConcern(&#39;a&#39;)</div>
<div class="line">mquery().r(&#39;a&#39;)</div>
<div class="line"> </div>
<div class="line">// majority</div>
<div class="line">mquery().readConcern(&#39;majority&#39;)</div>
<div class="line">mquery().readConcern(&#39;m&#39;)</div>
<div class="line">mquery().r(&#39;m&#39;)</div>
<div class="line"> </div>
<div class="line">// linearizable</div>
<div class="line">mquery().readConcern(&#39;linearizable&#39;)</div>
<div class="line">mquery().readConcern(&#39;lz&#39;)</div>
<div class="line">mquery().r(&#39;lz&#39;)</div>
<div class="line"> </div>
<div class="line">// snapshot</div>
<div class="line">mquery().readConcern(&#39;snapshot&#39;)</div>
<div class="line">mquery().readConcern(&#39;s&#39;)</div>
<div class="line">mquery().r(&#39;s&#39;)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md31176"></a>
Read Concern Level:</h3>
<ul>
<li><code>local</code> - The query returns from the instance with no guarantee guarantee that the data has been written to a majority of the replica set members (i.e. may be rolled back). (MongoDB 3.2+)</li>
<li><code>available</code> - The query returns from the instance with no guarantee guarantee that the data has been written to a majority of the replica set members (i.e. may be rolled back). (MongoDB 3.6+)</li>
<li><code>majority</code> - The query returns the data that has been acknowledged by a majority of the replica set members. The documents returned by the read operation are durable, even in the event of failure. (MongoDB 3.2+)</li>
<li><code>linearizable</code> - The query returns data that reflects all successful majority-acknowledged writes that completed prior to the start of the read operation. The query may wait for concurrently executing writes to propagate to a majority of replica set members before returning results. (MongoDB 3.4+)</li>
<li><code>snapshot</code> - Only available for operations within multi-document transactions. Upon transaction commit with write concern "majority", the transaction operations are guaranteed to have read from a snapshot of majority-committed data. (MongoDB 4.0+)</li>
</ul>
<p>Aliases</p>
<ul>
<li><code>l</code> local</li>
<li><code>a</code> available</li>
<li><code>m</code> majority</li>
<li><code>lz</code> linearizable</li>
<li><code>s</code> snapshot</li>
</ul>
<p>Read more about how to use read concern <a href="https://docs.mongodb.com/manual/reference/read-concern/">here</a>.</p>
<h2><a class="anchor" id="autotoc_md31177"></a>
writeConcern()</h2>
<p>Sets the writeConcern option for the query.</p>
<p>This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<div class="fragment"><div class="line">mquery().writeConcern(0)</div>
<div class="line">mquery().writeConcern(1)</div>
<div class="line">mquery().writeConcern({ w: 1, j: true, wtimeout: 2000 })</div>
<div class="line">mquery().writeConcern(&#39;majority&#39;)</div>
<div class="line">mquery().writeConcern(&#39;m&#39;) // same as majority</div>
<div class="line">mquery().writeConcern(&#39;tagSetName&#39;) // if the tag set is &#39;m&#39;, use .writeConcern({ w: &#39;m&#39; }) instead</div>
<div class="line">mquery().w(1) // w is alias of writeConcern</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md31178"></a>
Write Concern:</h3>
<p>writeConcern({ w: <code>&lt;value&gt;</code>, j: <code>&lt;boolean&gt;</code>, wtimeout: <code>&lt;number&gt;</code> }`)</p>
<ul>
<li>the w option to request acknowledgement that the write operation has propagated to a specified number of mongod instances or to mongod instances with specified tags</li>
<li>the j option to request acknowledgement that the write operation has been written to the journal</li>
<li>the wtimeout option to specify a time limit to prevent write operations from blocking indefinitely</li>
</ul>
<p>Can be break down to use the following syntax:</p>
<p>mquery().w(<code>&lt;value&gt;</code>).j(<code>&lt;boolean&gt;</code>).wtimeout(<code>&lt;number&gt;</code>)</p>
<p>Read more about how to use write concern <a href="https://docs.mongodb.com/manual/reference/write-concern/">here</a></p>
<h2><a class="anchor" id="autotoc_md31179"></a>
slaveOk()</h2>
<p>Sets the slaveOk option. <code>true</code> allows reading from secondaries.</p>
<p><b>deprecated</b> use read() preferences instead if on mongodb &gt;= 2.2</p>
<div class="fragment"><div class="line">query.slaveOk() // true</div>
<div class="line">query.slaveOk(true)</div>
<div class="line">query.slaveOk(false)</div>
</div><!-- fragment --><p><a href="http://docs.mongodb.org/manual/reference/method/rs.slaveOk/">MongoDB documentation</a></p>
<h2><a class="anchor" id="autotoc_md31180"></a>
tailable()</h2>
<p>Sets tailable option.</p>
<div class="fragment"><div class="line">mquery().tailable() &lt;== true</div>
<div class="line">mquery().tailable(true)</div>
<div class="line">mquery().tailable(false)</div>
</div><!-- fragment --><p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/tutorial/create-tailable-cursor/">MongoDB Documentation</a></p>
<h2><a class="anchor" id="autotoc_md31181"></a>
wtimeout()</h2>
<p>Specifies a time limit, in milliseconds, for the write concern. If <code>w &gt; 1</code>, it is maximum amount of time to wait for this write to propagate through the replica set before this operation fails. The default is <code>0</code>, which means no timeout.</p>
<p>This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to <code>wtimeout</code> value if it is specified in writeConcern</p>
<div class="fragment"><div class="line">mquery().wtimeout(2000)</div>
<div class="line">mquery().wTimeout(2000)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md31182"></a>
Helpers</h1>
<h2><a class="anchor" id="autotoc_md31183"></a>
collection()</h2>
<p>Sets the querys collection.</p>
<div class="fragment"><div class="line">mquery().collection(aCollection)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31184"></a>
then()</h2>
<p>Executes the query and returns a promise which will be resolved with the query results or rejected if the query responds with an error.</p>
<div class="fragment"><div class="line">mquery().find(..).then(success, error);</div>
</div><!-- fragment --><p>This is very useful when combined with <a href="https://github.com/visionmedia/co">co</a> or <a href="https://github.com/koajs/koa">koa</a>, which automatically resolve promise-like objects for you.</p>
<div class="fragment"><div class="line">co(function*(){</div>
<div class="line">  var doc = yield mquery().findOne({ _id: 499 });</div>
<div class="line">  console.log(doc); // { _id: 499, name: &#39;amazing&#39;, .. }</div>
<div class="line">})();</div>
</div><!-- fragment --><p><em>NOTE</em>: The returned promise is a <a href="https://github.com/petkaantonov/bluebird/">bluebird</a> promise but this is customizable. If you want to use your favorite promise library, simply set <code>mquery.Promise = YourPromiseConstructor</code>. Your <code>Promise</code> must be <a href="http://promisesaplus.com/">promises A+</a> compliant.</p>
<h2><a class="anchor" id="autotoc_md31185"></a>
merge(object)</h2>
<p>Merges other mquery or match condition objects into this one. When an mquery instance is passed, its match conditions, field selection and options are merged.</p>
<div class="fragment"><div class="line">const drum = mquery({ type: &#39;drum&#39; }).collection(instruments);</div>
<div class="line">const redDrum = mquery({ color: &#39;red&#39; }).merge(drum);</div>
<div class="line">const n = await redDrum.count();</div>
<div class="line">console.log(&#39;there are %d red drums&#39;, n);</div>
</div><!-- fragment --><p>Internally uses <code>mquery.canMerge</code> to determine validity.</p>
<h2><a class="anchor" id="autotoc_md31186"></a>
setOptions(options)</h2>
<p>Sets query options.</p>
<div class="fragment"><div class="line">mquery().setOptions({ collection: coll, limit: 20 })</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md31187"></a>
setOptions() options</h3>
<ul>
<li>tailable *</li>
<li>sort *</li>
<li>limit *</li>
<li>skip *</li>
<li>maxTime *</li>
<li>batchSize *</li>
<li>comment *</li>
<li>hint *</li>
<li>collection: the collection to query against</li>
</ul>
<p><em>* denotes a query helper method is also available</em></p>
<h2><a class="anchor" id="autotoc_md31188"></a>
setTraceFunction(func)</h2>
<p>Set a function to trace this query. Useful for profiling or logging.</p>
<div class="fragment"><div class="line">function traceFunction (method, queryInfo, query) {</div>
<div class="line">  console.log(&#39;starting &#39; + method + &#39; query&#39;);</div>
<div class="line"> </div>
<div class="line">  return function (err, result, millis) {</div>
<div class="line">    console.log(&#39;finished &#39; + method + &#39; query in &#39; + millis + &#39;ms&#39;);</div>
<div class="line">  };</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">mquery().setTraceFunction(traceFunction).findOne({name: &#39;Joe&#39;}, cb);</div>
</div><!-- fragment --><p>The trace function is passed (method, queryInfo, query)</p>
<ul>
<li>method is the name of the method being called (e.g. findOne)</li>
<li>queryInfo contains information about the query:<ul>
<li>conditions: query conditions/criteria</li>
<li>options: options such as sort, fields, etc</li>
<li>doc: document being updated</li>
</ul>
</li>
<li>query is the query object</li>
</ul>
<p>The trace function should return a callback function which accepts:</p><ul>
<li>err: error, if any</li>
<li>result: result, if any</li>
<li>millis: time spent waiting for query result</li>
</ul>
<p>NOTE: stream requests are not traced.</p>
<h2><a class="anchor" id="autotoc_md31189"></a>
mquery.setGlobalTraceFunction(func)</h2>
<p>Similar to <code>setTraceFunction()</code> but automatically applied to all queries.</p>
<div class="fragment"><div class="line">mquery.setTraceFunction(traceFunction);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31190"></a>
mquery.canMerge(conditions)</h2>
<p>Determines if <code>conditions</code> can be merged using <code>mquery().merge()</code>.</p>
<div class="fragment"><div class="line">var query = mquery({ type: &#39;drum&#39; });</div>
<div class="line">var okToMerge = mquery.canMerge(anObject)</div>
<div class="line">if (okToMerge) {</div>
<div class="line">  query.merge(anObject);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md31191"></a>
mquery.use$geoWithin</h1>
<p>MongoDB 2.4 introduced the <code>$geoWithin</code> operator which replaces and is 100% backward compatible with <code>$within</code>. As of mquery 0.2, we default to using <code>$geoWithin</code> for all <code>within()</code> calls.</p>
<p>If you are running MongoDB &lt; 2.4 this will be problematic. To force <code>mquery</code> to be backward compatible and always use <code>$within</code>, set the <code>mquery.use$geoWithin</code> flag to <code>false</code>.</p>
<div class="fragment"><div class="line">mquery.use$geoWithin = false;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md31192"></a>
Custom Base Queries</h1>
<p>Often times we want custom base queries that encapsulate predefined criteria. With <code>mquery</code> this is easy. First create the query you want to reuse and call its <code>toConstructor()</code> method which returns a new subclass of <code>mquery</code> that retains all options and criteria of the original.</p>
<div class="fragment"><div class="line">var greatMovies = mquery(movieCollection).where(&#39;rating&#39;).gte(4.5).toConstructor();</div>
<div class="line"> </div>
<div class="line">// use it!</div>
<div class="line">const n = await greatMovies().count();</div>
<div class="line">console.log(&#39;There are %d great movies&#39;, n);</div>
<div class="line"> </div>
<div class="line">const docs = await greatMovies().where({ name: /^Life/ }).select(&#39;name&#39;).find();</div>
<div class="line">console.log(docs);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md31193"></a>
Validation</h1>
<p>Method and options combinations are checked for validity at runtime to prevent creation of invalid query constructs. For example, a <code>distinct</code> query does not support specifying options like <code>hint</code> or field selection. In this case an error will be thrown so you can catch these mistakes in development.</p>
<h1><a class="anchor" id="autotoc_md31194"></a>
Debug support</h1>
<p>Debug mode is provided through the use of the <a href="https://github.com/visionmedia/debug">debug</a> module. To enable:</p>
<div class="fragment"><div class="line">DEBUG=mquery node yourprogram.js</div>
</div><!-- fragment --><p>Read the debug module documentation for more details.</p>
<h1><a class="anchor" id="autotoc_md31195"></a>
General compatibility</h1>
<h2><a class="anchor" id="autotoc_md31196"></a>
ObjectIds</h2>
<p><code>mquery</code> clones query arguments before passing them to a <code>collection</code> method for execution. This prevents accidental side-affects to the objects you pass. To clone <code>ObjectIds</code> we need to make some assumptions.</p>
<p>First, to check if an object is an <code>ObjectId</code>, we check its constructors name. If it matches either <code>ObjectId</code> or <code>ObjectID</code> we clone it.</p>
<p>To clone <code>ObjectIds</code>, we call its optional <code>clone</code> method. If a <code>clone</code> method does not exist, we fall back to calling <code>new obj.constructor(obj.id)</code>. We assume, for compatibility with the Node.js driver, that the <code>ObjectId</code> instance has a public <code>id</code> property and that when creating an <code>ObjectId</code> instance we can pass that <code>id</code> as an argument.</p>
<h3><a class="anchor" id="autotoc_md31197"></a>
Read Preferences</h3>
<p><code>mquery</code> supports specifying <a href="https://www.mongodb.com/docs/manual/core/read-preference/">Read Preferences</a> to control from which MongoDB node your query will read. The Read Preferences spec also support specifying tags. To pass tags, some drivers (Node.js driver) require passing a special constructor that handles both the read preference and its tags. If you need to specify tags, pass an instance of your drivers ReadPreference constructor or roll your own. <code>mquery</code> will store whatever you provide and pass later to your collection during execution.</p>
<h1><a class="anchor" id="autotoc_md31198"></a>
Future goals</h1>
<ul>
<li>mongo shell compatibility</li>
<li>browser compatibility</li>
</ul>
<h1><a class="anchor" id="autotoc_md31199"></a>
Installation</h1>
<div class="fragment"><div class="line">npm install mquery</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md31200"></a>
License</h1>
<p><a href="https://github.com/aheckmann/mquery/blob/master/LICENSE">MIT</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
