<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AREA: dns-packet</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AREA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">dns-packet</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md8941"></a><a href="https://www.npmjs.org/package/dns-packet"><img src="https://img.shields.io/npm/v/dns-packet.svg?style=flat" alt="" style="pointer-events: none;" class="inline"/></a> <a href="https://www.npmjs.org/package/dns-packet"><img src="https://img.shields.io/npm/dm/dns-packet.svg" alt="" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/github/mafintosh/dns-packet/workflows/ci.yml"><img src="https://github.com/github/mafintosh/dns-packet/workflows/ci.yml/badge.svg" alt="" style="pointer-events: none;" class="inline"/></a> <a href="https://coveralls.io/github/mafintosh/dns-packet?branch=master"><img src="https://coveralls.io/repos/github/mafintosh/dns-packet/badge.svg?branch=master" alt="Coverage Status" style="pointer-events: none;" class="inline"/></a></p>
<p>An <a href="https://github.com/mafintosh/abstract-encoding">abstract-encoding</a> compliant module for encoding / decoding DNS packets. Lifted out of <a href="https://github.com/mafintosh/multicast-dns">multicast-dns</a> as a separate module.</p>
<div class="fragment"><div class="line">npm install dns-packet</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md8942"></a>
UDP Usage</h1>
<div class="fragment"><div class="line"> js</div>
<div class="line">const dnsPacket = require(&#39;dns-packet&#39;)</div>
<div class="line">const dgram = require(&#39;dgram&#39;)</div>
<div class="line"> </div>
<div class="line">const socket = dgram.createSocket(&#39;udp4&#39;)</div>
<div class="line"> </div>
<div class="line">const buf = dnsPacket.encode({</div>
<div class="line">  type: &#39;query&#39;,</div>
<div class="line">  id: 1,</div>
<div class="line">  flags: dnsPacket.RECURSION_DESIRED,</div>
<div class="line">  questions: [{</div>
<div class="line">    type: &#39;A&#39;,</div>
<div class="line">    name: &#39;google.com&#39;</div>
<div class="line">  }]</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">socket.on(&#39;message&#39;, message =&gt; {</div>
<div class="line">  console.log(dnsPacket.decode(message)) // prints out a response from google dns</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">socket.send(buf, 0, buf.length, 53, &#39;8.8.8.8&#39;)</div>
</div><!-- fragment --><p>Also see <a href="examples/udp.js">the UDP example</a>.</p>
<h1><a class="anchor" id="autotoc_md8943"></a>
TCP, TLS, HTTPS</h1>
<p>While DNS has traditionally been used over a datagram transport, it is increasingly being carried over TCP for larger responses commonly including DNSSEC responses and TLS or HTTPS for enhanced security. See below examples on how to use <code>dns-packet</code> to wrap DNS packets in these protocols:</p>
<ul>
<li><a href="examples/tcp.js">TCP</a></li>
<li><a href="examples/tls.js">DNS over TLS</a></li>
<li><a href="examples/doh.js">DNS over HTTPS</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md8944"></a>
API</h1>
<h3><a class="anchor" id="autotoc_md8945"></a>
<code>var buf = packets.encode(packet, [buf], [offset])</code></h3>
<p>Encodes a DNS packet into a buffer containing a UDP payload.</p>
<h3><a class="anchor" id="autotoc_md8946"></a>
<code>var packet = packets.decode(buf, [offset])</code></h3>
<p>Decode a DNS packet from a buffer containing a UDP payload.</p>
<h3><a class="anchor" id="autotoc_md8947"></a>
<code>var buf = packets.streamEncode(packet, [buf], [offset])</code></h3>
<p>Encodes a DNS packet into a buffer containing a TCP payload.</p>
<h3><a class="anchor" id="autotoc_md8948"></a>
<code>var packet = packets.streamDecode(buf, [offset])</code></h3>
<p>Decode a DNS packet from a buffer containing a TCP payload.</p>
<h3><a class="anchor" id="autotoc_md8949"></a>
<code>var len = packets.encodingLength(packet)</code></h3>
<p>Returns how many bytes are needed to encode the DNS packet</p>
<h1><a class="anchor" id="autotoc_md8950"></a>
Packets</h1>
<p>Packets look like this</p>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  type: &#39;query|response&#39;,</div>
<div class="line">  id: optionalIdNumber,</div>
<div class="line">  flags: optionalBitFlags,</div>
<div class="line">  questions: [...],</div>
<div class="line">  answers: [...],</div>
<div class="line">  additionals: [...],</div>
<div class="line">  authorities: [...]</div>
<div class="line">}</div>
</div><!-- fragment --><p>The bit flags available are</p>
<div class="fragment"><div class="line"> js</div>
<div class="line">packet.RECURSION_DESIRED</div>
<div class="line">packet.RECURSION_AVAILABLE</div>
<div class="line">packet.TRUNCATED_RESPONSE</div>
<div class="line">packet.AUTHORITATIVE_ANSWER</div>
<div class="line">packet.AUTHENTIC_DATA</div>
<div class="line">packet.CHECKING_DISABLED</div>
</div><!-- fragment --><p>To use more than one flag bitwise-or them together</p>
<div class="fragment"><div class="line"> js</div>
<div class="line">var flags = packet.RECURSION_DESIRED | packet.RECURSION_AVAILABLE</div>
</div><!-- fragment --><p>And to check for a flag use bitwise-and</p>
<div class="fragment"><div class="line"> js</div>
<div class="line">var isRecursive = message.flags &amp; packet.RECURSION_DESIRED</div>
</div><!-- fragment --><p>A question looks like this</p>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  type: &#39;A&#39;, // or SRV, AAAA, etc</div>
<div class="line">  class: &#39;IN&#39;, // one of IN, CS, CH, HS, ANY. Default: IN</div>
<div class="line">  name: &#39;google.com&#39; // which record are you looking for</div>
<div class="line">}</div>
</div><!-- fragment --><p>And an answer, additional, or authority looks like this</p>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  type: &#39;A&#39;, // or SRV, AAAA, etc</div>
<div class="line">  class: &#39;IN&#39;, // one of IN, CS, CH, HS</div>
<div class="line">  name: &#39;google.com&#39;, // which name is this record for</div>
<div class="line">  ttl: optionalTimeToLiveInSeconds,</div>
<div class="line">  (record specific data, see below)</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md8951"></a>
Supported record types</h1>
<h3><a class="anchor" id="autotoc_md8952"></a>
<code>A</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  data: &#39;IPv4 address&#39; // fx 127.0.0.1</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8953"></a>
<code>AAAA</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  data: &#39;IPv6 address&#39; // fx fe80::1</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8954"></a>
<code>CAA</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  flags: 128, // octet</div>
<div class="line">  tag: &#39;issue|issuewild|iodef&#39;,</div>
<div class="line">  value: &#39;ca.example.net&#39;,</div>
<div class="line">  issuerCritical: false</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8955"></a>
<code>CNAME</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  data: &#39;cname.to.another.record&#39;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8956"></a>
<code>DNAME</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  data: &#39;dname.to.another.record&#39;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8957"></a>
<code>DNSKEY</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  flags: 257, // 16 bits</div>
<div class="line">  algorithm: 1, // octet</div>
<div class="line">  key: Buffer</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8958"></a>
<code>DS</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  keyTag: 12345,</div>
<div class="line">  algorithm: 8,</div>
<div class="line">  digestType: 1,</div>
<div class="line">  digest: Buffer</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8959"></a>
<code>HINFO</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  data: {</div>
<div class="line">    cpu: &#39;cpu info&#39;,</div>
<div class="line">    os: &#39;os info&#39;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8960"></a>
<code>MX</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  preference: 10,</div>
<div class="line">  exchange: &#39;mail.example.net&#39;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8961"></a>
<code>NAPTR</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  data:</div>
<div class="line">    {</div>
<div class="line">      order: 100,</div>
<div class="line">      preference: 10,</div>
<div class="line">      flags: &#39;s&#39;,</div>
<div class="line">      services: &#39;SIP+D2U&#39;,</div>
<div class="line">      regexp: &#39;!^.*$!sip:customer-service@example.com!&#39;,</div>
<div class="line">      replacement: &#39;_sip._udp.example.com&#39;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8962"></a>
<code>NS</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  data: nameServer</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8963"></a>
<code>NSEC</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  nextDomain: &#39;a.domain&#39;,</div>
<div class="line">  rrtypes: [&#39;A&#39;, &#39;TXT&#39;, &#39;RRSIG&#39;]</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8964"></a>
<code>NSEC3</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  algorithm: 1,</div>
<div class="line">  flags: 0,</div>
<div class="line">  iterations: 2,</div>
<div class="line">  salt: Buffer,</div>
<div class="line">  nextDomain: Buffer, // Hashed per RFC5155</div>
<div class="line">  rrtypes: [&#39;A&#39;, &#39;TXT&#39;, &#39;RRSIG&#39;]</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8965"></a>
<code>NULL</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  data: Buffer(&#39;any binary data&#39;)</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8966"></a>
<code>OPT</code></h3>
<p><a href="https://tools.ietf.org/html/rfc6891">EDNS0</a> options.</p>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  type: &#39;OPT&#39;,</div>
<div class="line">  name: &#39;.&#39;,</div>
<div class="line">  udpPayloadSize: 4096,</div>
<div class="line">  flags: packet.DNSSEC_OK,</div>
<div class="line">  options: [{</div>
<div class="line">    // pass in any code/data for generic EDNS0 options</div>
<div class="line">    code: 12,</div>
<div class="line">    data: Buffer.alloc(31)</div>
<div class="line">  }, {</div>
<div class="line">    // Several EDNS0 options have enhanced support</div>
<div class="line">    code: &#39;PADDING&#39;,</div>
<div class="line">    length: 31,</div>
<div class="line">  }, {</div>
<div class="line">    code: &#39;CLIENT_SUBNET&#39;,</div>
<div class="line">    family: 2, // 1 for IPv4, 2 for IPv6</div>
<div class="line">    sourcePrefixLength: 64, // used to truncate IP address</div>
<div class="line">    scopePrefixLength: 0,</div>
<div class="line">    ip: &#39;fe80::&#39;,</div>
<div class="line">  }, {</div>
<div class="line">    code: &#39;TCP_KEEPALIVE&#39;,</div>
<div class="line">    timeout: 150 // increments of 100ms.  This means 15s.</div>
<div class="line">  }, {</div>
<div class="line">    code: &#39;KEY_TAG&#39;,</div>
<div class="line">    tags: [1, 2, 3],</div>
<div class="line">  }]</div>
<div class="line">}</div>
</div><!-- fragment --><p>The options <code>PADDING</code>, <code>CLIENT_SUBNET</code>, <code>TCP_KEEPALIVE</code> and <code>KEY_TAG</code> support enhanced de/encoding. See <a href="https://github.com/mafintosh/dns-packet/blob/master/optioncodes.js">optionscodes.js</a> for all supported option codes. If the <code>data</code> property is present on a option, it takes precedence. On decoding, <code>data</code> will always be defined.</p>
<h3><a class="anchor" id="autotoc_md8967"></a>
<code>PTR</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  data: &#39;points.to.another.record&#39;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8968"></a>
<code>RP</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  mbox: &#39;admin.example.com&#39;,</div>
<div class="line">  txt: &#39;txt.example.com&#39;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8969"></a>
<code>SSHFP</code></h3>
<div class="fragment"><div class="line"> js</div>
<div class="line">{</div>
<div class="line">  algorithm: 1,</div>
<div class="line">  hash: 1,</div>
<div class="line">  fingerprint: &#39;A108C9F834354D5B37AF988141C9294822F5BC00&#39;</div>
<div class="line">}</div>
<div class="line">````</div>
<div class="line"> </div>
<div class="line">#### `RRSIG`</div>
</div><!-- fragment --><p> js { typeCovered: 'A', algorithm: 8, labels: 1, originalTTL: 3600, expiration: timestamp, inception: timestamp, keyTag: 12345, signersName: 'a.name', signature: Buffer } </p><div class="fragment"><div class="line">#### `SOA`</div>
</div><!-- fragment --><p> js { data: { mname: domainName, rname: mailbox, serial: zoneSerial, refresh: refreshInterval, retry: retryInterval, expire: expireInterval, minimum: minimumTTL } } </p><div class="fragment"><div class="line">#### `SRV`</div>
</div><!-- fragment --><p> js { data: { port: servicePort, target: serviceHostName, priority: optionalServicePriority, weight: optionalServiceWeight } } </p><div class="fragment"><div class="line">#### `TLSA`</div>
</div><!-- fragment --><p> js { usage: 3, selector: 1, matchingType: 1, certificate: Buffer } </p><div class="fragment"><div class="line">#### `TXT`</div>
</div><!-- fragment --><p> js { data: 'text' || Buffer || [ Buffer || 'text' ] } ```</p>
<p>When encoding, scalar values are converted to an array and strings are converted to UTF-8 encoded Buffers. When decoding, the return value will always be an array of Buffer.</p>
<p>If you need another record type, open an issue and we'll try to add it.</p>
<h1><a class="anchor" id="autotoc_md8970"></a>
License</h1>
<p>MIT </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
