<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AREA: http-proxy-middleware</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AREA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">http-proxy-middleware</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md14267"></a> <a href="https://github.com/chimurai/http-proxy-middleware/actions?query=branch%3Amaster"><img src="https://img.shields.io/github/workflow/status/chimurai/http-proxy-middleware/CI/master?style=flat-square" alt="GitHub Workflow Status (branch)" class="inline"/></a> <a href="https://coveralls.io/r/chimurai/http-proxy-middleware"><img src="https://img.shields.io/coveralls/chimurai/http-proxy-middleware.svg?style=flat-square" alt="Coveralls" style="pointer-events: none;" class="inline"/></a> <a href="https://snyk.io/test/npm/http-proxy-middleware"><img src="https://snyk.io/test/npm/http-proxy-middleware/badge.svg?style=flat-square" alt="dependency Status" style="pointer-events: none;" class="inline"/></a> <a href="https://www.npmjs.com/package/http-proxy-middleware"><img src="https://img.shields.io/npm/v/http-proxy-middleware?color=%23CC3534&amp;style=flat-square" alt="npm" class="inline"/></a></p>
<p>Node.js proxying made simple. Configure proxy middleware with ease for <a href="https://github.com/senchalabs/connect">connect</a>, <a href="https://github.com/strongloop/express">express</a>, <a href="https://github.com/BrowserSync/browser-sync">browser-sync</a> and many more.</p>
<p>Powered by the popular Nodejitsu <a href="https://github.com/nodejitsu/node-http-proxy"><code>http-proxy</code></a>. <a href="https://github.com/nodejitsu/node-http-proxy"><img src="https://img.shields.io/github/stars/nodejitsu/node-http-proxy.svg?style=social&amp;label=Star" alt="GitHub stars" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md14268"></a>
⚠️ Note </h1>
<p>This page is showing documentation for version v2.x.x (<a href="https://github.com/chimurai/http-proxy-middleware/releases">release notes</a>)</p>
<p>If you're looking for v0.x documentation. Go to: <a href="https://github.com/chimurai/http-proxy-middleware/tree/v0.21.0#readme">https://github.com/chimurai/http-proxy-middleware/tree/v0.21.0#readme</a></p>
<h1><a class="anchor" id="autotoc_md14269"></a>
TL;DR </h1>
<p>Proxy <code>/api</code> requests to <code><a href="http://www.example.org">http://www.example.org</a></code></p>
<div class="fragment"><div class="line">// javascript</div>
<div class="line"> </div>
<div class="line">const express = require(&#39;express&#39;);</div>
<div class="line">const { createProxyMiddleware } = require(&#39;http-proxy-middleware&#39;);</div>
<div class="line"> </div>
<div class="line">const app = express();</div>
<div class="line"> </div>
<div class="line">app.use(&#39;/api&#39;, createProxyMiddleware({ target: &#39;http://www.example.org&#39;, changeOrigin: true }));</div>
<div class="line">app.listen(3000);</div>
<div class="line"> </div>
<div class="line">// http://localhost:3000/api/foo/bar -&gt; http://www.example.org/api/foo/bar</div>
</div><!-- fragment --><div class="fragment"><div class="line">// typescript</div>
<div class="line"> </div>
<div class="line">import * as express from &#39;express&#39;;</div>
<div class="line">import { createProxyMiddleware, Filter, Options, RequestHandler } from &#39;http-proxy-middleware&#39;;</div>
<div class="line"> </div>
<div class="line">const app = express();</div>
<div class="line"> </div>
<div class="line">app.use(&#39;/api&#39;, createProxyMiddleware({ target: &#39;http://www.example.org&#39;, changeOrigin: true }));</div>
<div class="line">app.listen(3000);</div>
<div class="line"> </div>
<div class="line">// http://localhost:3000/api/foo/bar -&gt; http://www.example.org/api/foo/bar</div>
</div><!-- fragment --><p><em>All</em> <code>http-proxy</code> <a href="https://github.com/nodejitsu/node-http-proxy#options">options</a> can be used, along with some extra <code>http-proxy-middleware</code> <a class="el" href="md_web_2node__modules_2node-forge_2README.html#options">options</a>.</p>
<p>:bulb: <b>Tip:</b> Set the option <code>changeOrigin</code> to <code>true</code> for <a href="http://en.wikipedia.org/wiki/Virtual_hosting#Name-based">name-based virtual hosted sites</a>.</p>
<h1><a class="anchor" id="autotoc_md14270"></a>
Table of Contents </h1>
<ul>
<li>Install</li>
<li>Core concept</li>
<li>Example</li>
<li>Context matching</li>
<li><a class="el" href="md_web_2node__modules_2node-forge_2README.html#options">Options</a><ul>
<li>http-proxy-middleware options</li>
<li>http-proxy events</li>
<li>http-proxy options</li>
</ul>
</li>
<li>Shorthand<ul>
<li>app.use(path, proxy)</li>
</ul>
</li>
<li>WebSocket<ul>
<li>External WebSocket upgrade</li>
</ul>
</li>
<li>Intercept and manipulate requests</li>
<li>Intercept and manipulate responses</li>
<li>Working examples</li>
<li>Recipes</li>
<li>Compatible servers</li>
<li>Tests</li>
<li>Changelog</li>
<li>License</li>
</ul>
<h1><a class="anchor" id="autotoc_md14271"></a>
Install</h1>
<div class="fragment"><div class="line">$ npm install --save-dev http-proxy-middleware</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14272"></a>
Core concept</h1>
<p>Proxy middleware configuration.</p>
<h3><a class="anchor" id="autotoc_md14273"></a>
createProxyMiddleware([context,] config)</h3>
<div class="fragment"><div class="line">const { createProxyMiddleware } = require(&#39;http-proxy-middleware&#39;);</div>
<div class="line"> </div>
<div class="line">const apiProxy = createProxyMiddleware(&#39;/api&#39;, { target: &#39;http://www.example.org&#39; });</div>
<div class="line">//                                    \____/   \_____________________________/</div>
<div class="line">//                                      |                    |</div>
<div class="line">//                                    context             options</div>
<div class="line"> </div>
<div class="line">// &#39;apiProxy&#39; is now ready to be used as middleware in a server.</div>
</div><!-- fragment --><ul>
<li><b>context</b>: Determine which requests should be proxied to the target host. (more on context matching)</li>
<li><b>options.target</b>: target host to proxy to. _(protocol + host)_</li>
</ul>
<p>(full list of <a class="el" href="md_web_2node__modules_2node-forge_2README.html#options">`http-proxy-middleware` configuration options</a>)</p>
<h3><a class="anchor" id="autotoc_md14274"></a>
createProxyMiddleware(uri [, config])</h3>
<div class="fragment"><div class="line">// shorthand syntax for the example above:</div>
<div class="line">const apiProxy = createProxyMiddleware(&#39;http://www.example.org/api&#39;);</div>
</div><!-- fragment --><p>More about the shorthand configuration.</p>
<h1><a class="anchor" id="autotoc_md14275"></a>
Example</h1>
<p>An example with <code>express</code> server.</p>
<div class="fragment"><div class="line">// include dependencies</div>
<div class="line">const express = require(&#39;express&#39;);</div>
<div class="line">const { createProxyMiddleware } = require(&#39;http-proxy-middleware&#39;);</div>
<div class="line"> </div>
<div class="line">// proxy middleware options</div>
<div class="line">/** @type {import(&#39;http-proxy-middleware/dist/types&#39;).Options} */</div>
<div class="line">const options = {</div>
<div class="line">  target: &#39;http://www.example.org&#39;, // target host</div>
<div class="line">  changeOrigin: true, // needed for virtual hosted sites</div>
<div class="line">  ws: true, // proxy websockets</div>
<div class="line">  pathRewrite: {</div>
<div class="line">    &#39;^/api/old-path&#39;: &#39;/api/new-path&#39;, // rewrite path</div>
<div class="line">    &#39;^/api/remove/path&#39;: &#39;/path&#39;, // remove base path</div>
<div class="line">  },</div>
<div class="line">  router: {</div>
<div class="line">    // when request.headers.host == &#39;dev.localhost:3000&#39;,</div>
<div class="line">    // override target &#39;http://www.example.org&#39; to &#39;http://localhost:8000&#39;</div>
<div class="line">    &#39;dev.localhost:3000&#39;: &#39;http://localhost:8000&#39;,</div>
<div class="line">  },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">// create the proxy (without context)</div>
<div class="line">const exampleProxy = createProxyMiddleware(options);</div>
<div class="line"> </div>
<div class="line">// mount `exampleProxy` in web server</div>
<div class="line">const app = express();</div>
<div class="line">app.use(&#39;/api&#39;, exampleProxy);</div>
<div class="line">app.listen(3000);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14276"></a>
Context matching</h1>
<p>Providing an alternative way to decide which requests should be proxied; In case you are not able to use the server's <a href="http://expressjs.com/en/4x/api.html#app.use"><code>path</code> parameter</a> to mount the proxy or when you need more flexibility.</p>
<p><a href="https://tools.ietf.org/html/rfc3986#section-3.3">RFC 3986 <code>path</code></a> is used for context matching.</p>
<div class="fragment"><div class="line">  foo://example.com:8042/over/there?name=ferret#nose</div>
<div class="line">  \_/   \______________/\_________/ \_________/ \__/</div>
<div class="line">   |           |            |            |        |</div>
<div class="line">scheme     authority       path        query   fragment</div>
</div><!-- fragment --><ul>
<li><b>path matching</b><ul>
<li><code>createProxyMiddleware({...})</code> - matches any path, all requests will be proxied.</li>
<li>&lsquo;createProxyMiddleware(&rsquo;/', {...})<code>- matches any path, all requests will be proxied. -</code>createProxyMiddleware('/api', {...})<code>- matches paths starting with</code>/api`</li>
</ul>
</li>
<li><b>multiple path matching</b><ul>
<li>&lsquo;createProxyMiddleware([&rsquo;/api', '/ajax', '/someotherpath'], {...})`</li>
</ul>
</li>
<li><p class="startli"><b>wildcard path matching</b></p>
<p class="startli">For fine-grained control you can use wildcard matching. Glob pattern matching is done by <em>micromatch</em>. Visit <a href="https://www.npmjs.com/package/micromatch">micromatch</a> or <a href="https://www.npmjs.com/package/glob">glob</a> for more globbing examples.</p><ul>
<li>&lsquo;createProxyMiddleware(&rsquo;**', {...})<code>matches any path, all requests will be proxied. -</code>createProxyMiddleware('**/*.html', {...})<code>matches any path which ends with</code>.html<code> -</code>createProxyMiddleware('/*.html', {...})<code>matches paths directly under path-absolute -</code>createProxyMiddleware('/api/**/*.html', {...})<code>matches requests ending with</code>.html<code>in the path of</code>/api<code> -</code>createProxyMiddleware(['/api/**', '/ajax/**'], {...})<code>combine multiple patterns -</code>createProxyMiddleware(['/api/**', '!**/bad.json'], {...})` exclusion</li>
</ul>
<p class="startli"><b>Note</b>: In multiple path matching, you cannot use string paths and wildcard paths together.</p>
</li>
<li><p class="startli"><b>custom matching</b></p>
<p class="startli">For full control you can provide a custom function to determine which requests should be proxied or not.</p>
<div class="fragment"><div class="line">/**</div>
<div class="line"> * @return {Boolean}</div>
<div class="line"> */</div>
<div class="line">const filter = function (pathname, req) {</div>
<div class="line">  return pathname.match(&#39;^/api&#39;) &amp;&amp; req.method === &#39;GET&#39;;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">const apiProxy = createProxyMiddleware(filter, {</div>
<div class="line">  target: &#39;http://www.example.org&#39;,</div>
<div class="line">});</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md14277"></a>
Options</h1>
<h2><a class="anchor" id="autotoc_md14278"></a>
http-proxy-middleware options</h2>
<ul>
<li><p class="startli"><b>option.pathRewrite</b>: object/function, rewrite target's url path. Object-keys will be used as <em>RegExp</em> to match paths.</p>
<div class="fragment"><div class="line">// rewrite path</div>
<div class="line">pathRewrite: {&#39;^/old/api&#39; : &#39;/new/api&#39;}</div>
<div class="line"> </div>
<div class="line">// remove path</div>
<div class="line">pathRewrite: {&#39;^/remove/api&#39; : &#39;&#39;}</div>
<div class="line"> </div>
<div class="line">// add base path</div>
<div class="line">pathRewrite: {&#39;^/&#39; : &#39;/basepath/&#39;}</div>
<div class="line"> </div>
<div class="line">// custom rewriting</div>
<div class="line">pathRewrite: function (path, req) { return path.replace(&#39;/api&#39;, &#39;/base/api&#39;) }</div>
<div class="line"> </div>
<div class="line">// custom rewriting, returning Promise</div>
<div class="line">pathRewrite: async function (path, req) {</div>
<div class="line">  const should_add_something = await httpRequestToDecideSomething(path);</div>
<div class="line">  if (should_add_something) path += &quot;something&quot;;</div>
<div class="line">  return path;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>option.router</b>: object/function, re-target <code>option.target</code> for specific requests.</p>
<div class="fragment"><div class="line">// Use `host` and/or `path` to match requests. First match will be used.</div>
<div class="line">// The order of the configuration matters.</div>
<div class="line">router: {</div>
<div class="line">    &#39;integration.localhost:3000&#39; : &#39;http://localhost:8001&#39;,  // host only</div>
<div class="line">    &#39;staging.localhost:3000&#39;     : &#39;http://localhost:8002&#39;,  // host only</div>
<div class="line">    &#39;localhost:3000/api&#39;         : &#39;http://localhost:8003&#39;,  // host + path</div>
<div class="line">    &#39;/rest&#39;                      : &#39;http://localhost:8004&#39;   // path only</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Custom router function (string target)</div>
<div class="line">router: function(req) {</div>
<div class="line">    return &#39;http://localhost:8004&#39;;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Custom router function (target object)</div>
<div class="line">router: function(req) {</div>
<div class="line">    return {</div>
<div class="line">        protocol: &#39;https:&#39;, // The : is required</div>
<div class="line">        host: &#39;localhost&#39;,</div>
<div class="line">        port: 8004</div>
<div class="line">    };</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Asynchronous router function which returns promise</div>
<div class="line">router: async function(req) {</div>
<div class="line">    const url = await doSomeIO();</div>
<div class="line">    return url;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><b>option.logLevel</b>: string, ['debug', 'info', 'warn', 'error', 'silent']. Default: &lsquo;'info&rsquo;`</li>
<li><p class="startli"><b>option.logProvider</b>: function, modify or replace log provider. Default: <code>console</code>.</p>
<div class="fragment"><div class="line">// simple replace</div>
<div class="line">function logProvider(provider) {</div>
<div class="line">  // replace the default console log provider.</div>
<div class="line">  return require(&#39;winston&#39;);</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">// verbose replacement</div>
<div class="line">function logProvider(provider) {</div>
<div class="line">  const logger = new (require(&#39;winston&#39;).Logger)();</div>
<div class="line"> </div>
<div class="line">  const myCustomProvider = {</div>
<div class="line">    log: logger.log,</div>
<div class="line">    debug: logger.debug,</div>
<div class="line">    info: logger.info,</div>
<div class="line">    warn: logger.warn,</div>
<div class="line">    error: logger.error,</div>
<div class="line">  };</div>
<div class="line">  return myCustomProvider;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md14279"></a>
http-proxy events</h2>
<p>Subscribe to <a href="https://github.com/nodejitsu/node-http-proxy#listening-for-proxy-events">http-proxy events</a>:</p>
<ul>
<li><p class="startli"><b>option.onError</b>: function, subscribe to http-proxy's <code>error</code> event for custom error handling.</p>
<div class="fragment"><div class="line">function onError(err, req, res, target) {</div>
<div class="line">  res.writeHead(500, {</div>
<div class="line">    &#39;Content-Type&#39;: &#39;text/plain&#39;,</div>
<div class="line">  });</div>
<div class="line">  res.end(&#39;Something went wrong. And we are reporting a custom error message.&#39;);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>option.onProxyRes</b>: function, subscribe to http-proxy's <code>proxyRes</code> event.</p>
<div class="fragment"><div class="line">function onProxyRes(proxyRes, req, res) {</div>
<div class="line">  proxyRes.headers[&#39;x-added&#39;] = &#39;foobar&#39;; // add new header to response</div>
<div class="line">  delete proxyRes.headers[&#39;x-removed&#39;]; // remove header from response</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>option.onProxyReq</b>: function, subscribe to http-proxy's <code>proxyReq</code> event.</p>
<div class="fragment"><div class="line">function onProxyReq(proxyReq, req, res) {</div>
<div class="line">  // add custom header to request</div>
<div class="line">  proxyReq.setHeader(&#39;x-added&#39;, &#39;foobar&#39;);</div>
<div class="line">  // or log the req</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>option.onProxyReqWs</b>: function, subscribe to http-proxy's <code>proxyReqWs</code> event.</p>
<div class="fragment"><div class="line">function onProxyReqWs(proxyReq, req, socket, options, head) {</div>
<div class="line">  // add custom header</div>
<div class="line">  proxyReq.setHeader(&#39;X-Special-Proxy-Header&#39;, &#39;foobar&#39;);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>option.onOpen</b>: function, subscribe to http-proxy's <code>open</code> event.</p>
<div class="fragment"><div class="line">function onOpen(proxySocket) {</div>
<div class="line">  // listen for messages coming FROM the target here</div>
<div class="line">  proxySocket.on(&#39;data&#39;, hybridParseAndLogMessage);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>option.onClose</b>: function, subscribe to http-proxy's <code>close</code> event.</p>
<div class="fragment"><div class="line">function onClose(res, socket, head) {</div>
<div class="line">  // view disconnected websocket connections</div>
<div class="line">  console.log(&#39;Client disconnected&#39;);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md14280"></a>
http-proxy options</h2>
<p>The following options are provided by the underlying <a href="https://github.com/nodejitsu/node-http-proxy#options">http-proxy</a> library.</p>
<ul>
<li><b>option.target</b>: url string to be parsed with the url module</li>
<li><b>option.forward</b>: url string to be parsed with the url module</li>
<li><b>option.agent</b>: object to be passed to http(s).request (see Node's <a href="http://nodejs.org/api/https.html#https_class_https_agent">https agent</a> and <a href="http://nodejs.org/api/http.html#http_class_http_agent">http agent</a> objects)</li>
<li><b>option.ssl</b>: object to be passed to https.createServer()</li>
<li><b>option.ws</b>: true/false: if you want to proxy websockets</li>
<li><b>option.xfwd</b>: true/false, adds x-forward headers</li>
<li><b>option.secure</b>: true/false, if you want to verify the SSL Certs</li>
<li><b>option.toProxy</b>: true/false, passes the absolute URL as the <code>path</code> (useful for proxying to proxies)</li>
<li><b>option.prependPath</b>: true/false, Default: true - specify whether you want to prepend the target's path to the proxy path</li>
<li><b>option.ignorePath</b>: true/false, Default: false - specify whether you want to ignore the proxy path of the incoming request (note: you will have to append / manually if required).</li>
<li><b>option.localAddress</b> : Local interface string to bind for outgoing connections</li>
<li><b>option.changeOrigin</b>: true/false, Default: false - changes the origin of the host header to the target URL</li>
<li><b>option.preserveHeaderKeyCase</b>: true/false, Default: false - specify whether you want to keep letter case of response header key</li>
<li><b>option.auth</b> : Basic authentication i.e. 'user:password' to compute an Authorization header.</li>
<li><b>option.hostRewrite</b>: rewrites the location hostname on (301/302/307/308) redirects.</li>
<li><b>option.autoRewrite</b>: rewrites the location host/port on (301/302/307/308) redirects based on requested host/port. Default: false.</li>
<li><b>option.protocolRewrite</b>: rewrites the location protocol on (301/302/307/308) redirects to 'http' or 'https'. Default: null.</li>
<li><b>option.cookieDomainRewrite</b>: rewrites domain of <code>set-cookie</code> headers. Possible values:<ul>
<li><code>false</code> (default): disable cookie rewriting</li>
<li>String: new domain, for example <code>cookieDomainRewrite: "new.domain"</code>. To remove the domain, use <code>cookieDomainRewrite: ""</code>.</li>
<li>Object: mapping of domains to new domains, use <code>"*"</code> to match all domains. <br  />
 For example keep one domain unchanged, rewrite one domain and remove other domains: <div class="fragment"><div class="line">cookieDomainRewrite: {</div>
<div class="line">  &quot;unchanged.domain&quot;: &quot;unchanged.domain&quot;,</div>
<div class="line">  &quot;old.domain&quot;: &quot;new.domain&quot;,</div>
<div class="line">  &quot;*&quot;: &quot;&quot;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
</li>
<li><b>option.cookiePathRewrite</b>: rewrites path of <code>set-cookie</code> headers. Possible values:<ul>
<li><code>false</code> (default): disable cookie rewriting</li>
<li>String: new path, for example <code>cookiePathRewrite: "/newPath/"</code>. To remove the path, use <code>cookiePathRewrite: ""</code>. To set path to root use <code>cookiePathRewrite: "/"</code>.</li>
<li>Object: mapping of paths to new paths, use <code>"*"</code> to match all paths. For example, to keep one path unchanged, rewrite one path and remove other paths: <div class="fragment"><div class="line">cookiePathRewrite: {</div>
<div class="line">  &quot;/unchanged.path/&quot;: &quot;/unchanged.path/&quot;,</div>
<div class="line">  &quot;/old.path/&quot;: &quot;/new.path/&quot;,</div>
<div class="line">  &quot;*&quot;: &quot;&quot;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
</li>
<li><b>option.headers</b>: object, adds <a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Request_fields">request headers</a>. (Example: &lsquo;{host:'www.example.org&rsquo;}<code>)</code></li>
<li><code>**option.proxyTimeout**: timeout (in millis) when proxy receives no response from target</code></li>
<li><code>**option.timeout**: timeout (in millis) for incoming requests</code></li>
<li><code>**option.followRedirects**: true/false, Default: false - specify whether you want to follow redirects</code></li>
<li><code>**option.selfHandleResponse** true/false, if set to true, none of the webOutgoing passes are called and it's your responsibility to appropriately return the response by listening and acting on the</code>proxyRes&lsquo; event</li>
<li><p class="startli">**option.buffer**: stream of data to send as the request body. Maybe you have some middleware that consumes the request stream before proxying it on e.g. If you read the body of a request into a field called 'req.rawbody&rsquo; you could restream this field in the buffer option:</p>
<div class="fragment"><div class="line">&#39;use strict&#39;;</div>
<div class="line"> </div>
<div class="line">const streamify = require(&#39;stream-array&#39;);</div>
<div class="line">const HttpProxy = require(&#39;http-proxy&#39;);</div>
<div class="line">const proxy = new HttpProxy();</div>
<div class="line"> </div>
<div class="line">module.exports = (req, res, next) =&gt; {</div>
<div class="line">  proxy.web(</div>
<div class="line">    req,</div>
<div class="line">    res,</div>
<div class="line">    {</div>
<div class="line">      target: &#39;http://localhost:4003/&#39;,</div>
<div class="line">      buffer: streamify(req.rawBody),</div>
<div class="line">    },</div>
<div class="line">    next</div>
<div class="line">  );</div>
<div class="line">};</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md14281"></a>
Shorthand</h1>
<p>Use the shorthand syntax when verbose configuration is not needed. The <code>context</code> and <code>option.target</code> will be automatically configured when shorthand is used. Options can still be used if needed.</p>
<div class="fragment"><div class="line">createProxyMiddleware(&#39;http://www.example.org:8000/api&#39;);</div>
<div class="line">// createProxyMiddleware(&#39;/api&#39;, {target: &#39;http://www.example.org:8000&#39;});</div>
<div class="line"> </div>
<div class="line">createProxyMiddleware(&#39;http://www.example.org:8000/api/books/*/**.json&#39;);</div>
<div class="line">// createProxyMiddleware(&#39;/api/books/*/**.json&#39;, {target: &#39;http://www.example.org:8000&#39;});</div>
<div class="line"> </div>
<div class="line">createProxyMiddleware(&#39;http://www.example.org:8000/api&#39;, { changeOrigin: true });</div>
<div class="line">// createProxyMiddleware(&#39;/api&#39;, {target: &#39;http://www.example.org:8000&#39;, changeOrigin: true});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md14282"></a>
app.use(path, proxy)</h2>
<p>If you want to use the server's <code>app.use</code> <code>path</code> parameter to match requests; Create and mount the proxy without the http-proxy-middleware <code>context</code> parameter:</p>
<div class="fragment"><div class="line">app.use(&#39;/api&#39;, createProxyMiddleware({ target: &#39;http://www.example.org&#39;, changeOrigin: true }));</div>
</div><!-- fragment --><p><code>app.use</code> documentation:</p>
<ul>
<li>express: <a href="http://expressjs.com/en/4x/api.html#app.use">http://expressjs.com/en/4x/api.html#app.use</a></li>
<li>connect: <a href="https://github.com/senchalabs/connect#mount-middleware">https://github.com/senchalabs/connect#mount-middleware</a></li>
<li>polka: <a href="https://github.com/lukeed/polka#usebase-fn">https://github.com/lukeed/polka#usebase-fn</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md14283"></a>
WebSocket</h1>
<div class="fragment"><div class="line">// verbose api</div>
<div class="line">createProxyMiddleware(&#39;/&#39;, { target: &#39;http://echo.websocket.org&#39;, ws: true });</div>
<div class="line"> </div>
<div class="line">// shorthand</div>
<div class="line">createProxyMiddleware(&#39;http://echo.websocket.org&#39;, { ws: true });</div>
<div class="line"> </div>
<div class="line">// shorter shorthand</div>
<div class="line">createProxyMiddleware(&#39;ws://echo.websocket.org&#39;);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md14284"></a>
External WebSocket upgrade</h2>
<p>In the previous WebSocket examples, http-proxy-middleware relies on a initial http request in order to listen to the http <code>upgrade</code> event. If you need to proxy WebSockets without the initial http request, you can subscribe to the server's http <code>upgrade</code> event manually.</p>
<div class="fragment"><div class="line">const wsProxy = createProxyMiddleware(&#39;ws://echo.websocket.org&#39;, { changeOrigin: true });</div>
<div class="line"> </div>
<div class="line">const app = express();</div>
<div class="line">app.use(wsProxy);</div>
<div class="line"> </div>
<div class="line">const server = app.listen(3000);</div>
<div class="line">server.on(&#39;upgrade&#39;, wsProxy.upgrade); // &lt;-- subscribe to http &#39;upgrade&#39;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14285"></a>
Intercept and manipulate requests</h1>
<p>Intercept requests from downstream by defining <code>onProxyReq</code> in <code>createProxyMiddleware</code>.</p>
<p>Currently the only pre-provided request interceptor is <code>fixRequestBody</code>, which is used to fix proxied POST requests when <code>bodyParser</code> is applied before this middleware.</p>
<p>Example:</p>
<div class="fragment"><div class="line">const { createProxyMiddleware, fixRequestBody } = require(&#39;http-proxy-middleware&#39;);</div>
<div class="line"> </div>
<div class="line">const proxy = createProxyMiddleware({</div>
<div class="line">  /**</div>
<div class="line">   * Fix bodyParser</div>
<div class="line">   **/</div>
<div class="line">  onProxyReq: fixRequestBody,</div>
<div class="line">});</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14286"></a>
Intercept and manipulate responses</h1>
<p>Intercept responses from upstream with <code>responseInterceptor</code>. (Make sure to set <code>selfHandleResponse: true</code>)</p>
<p>Responses which are compressed with <code>brotli</code>, <code>gzip</code> and <code>deflate</code> will be decompressed automatically. The response will be returned as <code>buffer</code> (<a href="https://nodejs.org/api/buffer.html">docs</a>) which you can manipulate.</p>
<p>With <code>buffer</code>, response manipulation is not limited to text responses (html/css/js, etc...); image manipulation will be possible too. (<a href="https://github.com/chimurai/http-proxy-middleware/blob/master/recipes/response-interceptor.md#manipulate-image-response">example</a>)</p>
<p>NOTE: <code>responseInterceptor</code> disables streaming of target's response.</p>
<p>Example:</p>
<div class="fragment"><div class="line">const { createProxyMiddleware, responseInterceptor } = require(&#39;http-proxy-middleware&#39;);</div>
<div class="line"> </div>
<div class="line">const proxy = createProxyMiddleware({</div>
<div class="line">  /**</div>
<div class="line">   * IMPORTANT: avoid res.end being called automatically</div>
<div class="line">   **/</div>
<div class="line">  selfHandleResponse: true, // res.end() will be called internally by responseInterceptor()</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * Intercept response and replace &#39;Hello&#39; with &#39;Goodbye&#39;</div>
<div class="line">   **/</div>
<div class="line">  onProxyRes: responseInterceptor(async (responseBuffer, proxyRes, req, res) =&gt; {</div>
<div class="line">    const response = responseBuffer.toString(&#39;utf8&#39;); // convert buffer to string</div>
<div class="line">    return response.replace(&#39;Hello&#39;, &#39;Goodbye&#39;); // manipulate response and return the result</div>
<div class="line">  }),</div>
<div class="line">});</div>
</div><!-- fragment --><p>Check out <a href="https://github.com/chimurai/http-proxy-middleware/blob/master/recipes/response-interceptor.md#readme">interception recipes</a> for more examples.</p>
<h1><a class="anchor" id="autotoc_md14287"></a>
Working examples</h1>
<p>View and play around with <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples">working examples</a>.</p>
<ul>
<li>Browser-Sync (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/browser-sync/index.js">example source</a>)</li>
<li>express (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/express/index.js">example source</a>)</li>
<li>connect (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/connect/index.js">example source</a>)</li>
<li>WebSocket (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/websocket/index.js">example source</a>)</li>
<li>Response Manipulation (<a href="https://github.com/chimurai/http-proxy-middleware/blob/master/examples/response-interceptor/index.js">example source</a>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md14288"></a>
Recipes</h1>
<p>View the <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/recipes">recipes</a> for common use cases.</p>
<h1><a class="anchor" id="autotoc_md14289"></a>
Compatible servers</h1>
<p><code>http-proxy-middleware</code> is compatible with the following servers:</p>
<ul>
<li><a href="https://www.npmjs.com/package/connect">connect</a></li>
<li><a href="https://www.npmjs.com/package/express">express</a></li>
<li><a href="https://www.npmjs.com/package/fastify">fastify</a></li>
<li><a href="https://www.npmjs.com/package/browser-sync">browser-sync</a></li>
<li><a href="https://www.npmjs.com/package/lite-server">lite-server</a></li>
<li><a href="https://github.com/lukeed/polka">polka</a></li>
<li><a href="https://www.npmjs.com/package/grunt-contrib-connect">grunt-contrib-connect</a></li>
<li><a href="https://www.npmjs.com/package/grunt-browser-sync">grunt-browser-sync</a></li>
<li><a href="https://www.npmjs.com/package/gulp-connect">gulp-connect</a></li>
<li><a href="https://www.npmjs.com/package/gulp-webserver">gulp-webserver</a></li>
</ul>
<p>Sample implementations can be found in the <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/recipes/servers.md">server recipes</a>.</p>
<h1><a class="anchor" id="autotoc_md14290"></a>
Tests</h1>
<p>Run the test suite:</p>
<div class="fragment"><div class="line"># install dependencies</div>
<div class="line">$ yarn</div>
<div class="line"> </div>
<div class="line"># linting</div>
<div class="line">$ yarn lint</div>
<div class="line">$ yarn lint:fix</div>
<div class="line"> </div>
<div class="line"># building (compile typescript to js)</div>
<div class="line">$ yarn build</div>
<div class="line"> </div>
<div class="line"># unit tests</div>
<div class="line">$ yarn test</div>
<div class="line"> </div>
<div class="line"># code coverage</div>
<div class="line">$ yarn cover</div>
<div class="line"> </div>
<div class="line"># check spelling mistakes</div>
<div class="line">$ yarn spellcheck</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14291"></a>
Changelog</h1>
<ul>
<li><a href="https://github.com/chimurai/http-proxy-middleware/blob/master/CHANGELOG.md">View changelog</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md14292"></a>
License</h1>
<p>The MIT License (MIT)</p>
<p>Copyright (c) 2015-2022 Steven Chim </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
